var AdRollLiquidAds=AdRollLiquidAds||{};AdRollLiquidAds.createJS=createjs;AdRollLiquidAds.flashLib={};AdRollLiquidAds.flashImgs={};WebFontConfig={timeout:3e3,classes:false,adroll:false};AdRollLiquidAds.CONSTANTS={VERSION:"1.8.78",P_VERSION:"1.1.11",getVersion:function(){return initvars.type==AdRollLiquidAds.CONSTANTS.TYPE_PERSONALIZED?AdRollLiquidAds.CONSTANTS.P_VERSION:AdRollLiquidAds.CONSTANTS.VERSION},ADD_NAV:"add_nav",ADV_EID:"advertisable_eid",ALL_CAPS:"all_caps",ALLOW_LOG:"allow_log",ALLOW_VIDEO:"allow_video",ANIMATION_END_INDEX:"animation_end_index",AUTO_BLINK_CANCEL:"auto_blink_cancel",AUTO_SCROLL:"auto_scroll",BADGE_ID:"business_badge_id",BG_TAG:"backgroundTAG",CACHET_BUSTER:"cachet_buster",CLICK_TAG:"clickTAG",CLICK_OVERRIDE:"click_override",COOKIE_LIST:"cookie_list",COUNTDOWN_END:"countdown_end",CTA_URL:"cta_url",DEFAULT_CLICK:"default_click",DEMO:"demo",DYN_VIDEO:"dynamic_video",DYN_VIDEO_IMG:"dynamic_video_img",ENGAGE_TAG:"engageTAG",EXCLUDE_FILTER:"exclude_",EXP_CONFIGS:"experimentConfigs",EXTERNAL_FAIL_TAG:"externalFailTAG",FAIL_TAG:"failTAG",FEATURE_FLAGS:"feature_flags",FIELD_EXTENSION:"field_extension",FLYOVER_IMG:"flyover_image",FLYOVER_COUNT:"flyover_count",FLYOVER_CLICK:"flyover_click",FONT_URL:"font_url",FONT_MAP:"font_map",IDENTITY:"identity",INCLUDE_FILTER:"include_",INIT_LATENCY:"initiation_latency",LOGO_TAG:"logoTAG",MAX_RECS:"max_recs",MAX_TITLE_FIELDS:"max_title_fields",MAX_TITLE_LENGTH:"max_title_length",MIN_FONT_FIELDS:"min_font_fields",MIN_RECS:"min_recs",NAV_CANCEL:"nav_cancel",POSTFIX:"postfix",PERCENT_OFF:"percent_off",PREFIX:"prefix",PRELOAD_IMG:"preloader_image",PRELOAD_LATENCY:"preload_latency",PRICE:"price",PROD_ACT_EXCLUDE:"product_action_exclusion",PROD_ACT_INCLUDE_PURCH:"product_action_include_purchased",PRODUCTS:"prods",PRODUCT_CLICK:"product_click",PRODUCT_DATA:"product_data",PROD_TAG:"prodtag",PROD_GROUP_OVERRIDE:"product_group",RATING_MIN:"rating_min",RATING_SCALE:"rating_scale",RETINA_BG:"retina_bg",SALE_PRICE:"sale_price",SALE_PRICE_OPTION:"sale_price_option",SET_FIRST_PRODUCT:"set_first_product",SHARPENING:"sharpening",SHOW_OVERRIDE:"show_",SLIDESHOW_TIME:"slideshow_time",SMOOTHING:"smoothing",STAGE_CLICK:"stage_click",SWIPE_NEXT:"swipe_next",TEMPLATE_ID:"template_id",TEXT_COLOR_OVERRIDE:"color_",TEXT_OVERRIDE:"text_",TEXT_TWEAK_BRV:"brv_text_tweak",TEXT_TWEAK_CHR:"chr_text_tweak",TEXT_TWEAK_EDG:"edg_text_tweak",TEXT_TWEAK_FF:"ff_text_tweak",TEXT_TWEAK_SAF:"saf_text_tweak",THEME_COLOR_OVERRIDE:"theme_color",TITLE_CASE:"title_case",TRACK_DATA:"track_field_data",TRACKING:"tracking",TRANSITION_TIME:"transition_time",TRECS_BASE_TAG:"baseTrecstag",VIDEO_LOOP:"video_loop",VIDEO_LOOP_IMG:"video_loop_img",VIDEO_TAG:"videoTAG",STATUS_INIT:"init",STATUS_INTSL:"interstitial",STATUS_RUNNING:"running",STATUS_STOPPED:"stopped",STATUS_FAILED:"failed",B2B_UA_TAG:"attributes_tag",B2B_AD_EID:"advertisable_eid",B2B_KEYS_EID:"user_attributes_key",B2B_KEYS_PARAM:"keys_eid",B2B_UA_ATTS:"user_attributes",B2B_TXT_AREAS:"text_areas",B2B_CLICK_TAGS:"click_tags",B2B_MIN_FONT_SIZE:"min_font_size",B2B_LINE_BREAK:"[br]",B2B_BAD_ATTS:["unknown","undefined","null"],TYPE_DYNAMIC:"dynamic",TYPE_DYNAMIC_TWA:"dynamicAdBuilder",TYPE_DYNAMIC_TESTS:"dynamicUnitTests",TYPE_PERSONALIZED:"personalized",EVENT_INIT:"liquid_init",EVENT_OK:"liquid_ok",EVENT_IMG:"liquid_images",EVENT_CLICK:"liquid_click",EVENT_HOVER:"liquid_hover",EVENT_ENGAGEMENT:"liquid_act",EVENT_FAILURE:"liquid_error",EVENT_IMPRESSION:"liquid_impression",EVENT_PERS_IMPRESSION:"personalized_impression",EVENT_PERS_CLICK:"personalized_click",EVENT_PERS_FAILURE:"personalized_error",EVENT_TRECS_FALLBACK:"trecs_fallback",EVENT_TRECS_OK:"trecs_ok",FAIL_LOAD_CREATIVE:"1000",FAIL_LOAD_RECS:"1001",FAIL_LATENCY:"1002",FAIL_LOW_RECS:"1003",FAIL_LOW_PICS:"1004",FAIL_LOAD_CODE:"1005",FAIL_UNSUPPORTED:"1006",FAIL_LOAD_ATTRS:"1007",SALE_PRICE_OPTION_NONE:"0",SALE_PRICE_OPTION_PRICE:"1",SALE_PRICE_OPTION_SALE_PRICE:"2",SALE_PRICE_OPTION_PERCENT_OFF:"3",AFFIRM_MIN:50,AFFIRM_KEY:"affirm_key",AFFIRM_TEXT:"affirm_text",AFFIRM_APR:"affirm_apr",AFFIRM_TERM:"affirm_term",AFFIRM_DEFAULT_TERM:"12",AFFIRM_DEFAULT_APR:"0.10",AFFIRM_TAG:"https://calculator.affirm.com/promos/payment_estimate_path/",YOTPO_KEY:"yotpo_key",YOTPO_ID_OVERRIDE:"yotpo_id_override",YOTPO_REVIEW:"yotpo_review",YOTPO_CONTENT:"yotpo_content",YOTPO_USER:"yotpo_user",YOTPO_RATING:"yotpo_rating",YOTPO_TITLE:"yotpo_title",YOTPO_TAG:"https://s.adroll.com/ecommerce/production/yotpo-reviews/",YELP_GOOD_BIZ:"yelp_good_biz",YELP_WEAK_BIZ:"yelp_weak_biz",YELP_DEFAULT_CTA:"yelp_default_cta",YELP_TEMPLATE_IDS:["43","236","271","272","294"],YELP_DATA_TAG:"https://s.adroll.com/dynamic-creative/yelp/{eid}.json",YELP_INIT_TIMEOUT:8,BADGE_ART_PATH:"https://s.adroll.com/adroll-badges/",BADGE_CLICK_URL:"https://help.adroll.com/hc/en-us/articles/360058412272",IDENTITY:"identity",USER_RECS_INCLUDE:["identity","top_products","random"],USER_RECS_SRC_VIEWS:"views",FONT_LOADER_URL:"://ajax.googleapis.com/ajax/libs/webfont/1.5.6/webfont.js",ADROLL_FONT_CSS:"https://s.adroll.com/liquidads/html5/fonts/",DEFAULT_REC_PATH:"https://s.adroll.com/praxis/recs/dc/",CACHET_IMG_PATH:"https://t2.adroll.com/",CHR_TEXT_TWEAK:"chr_text_tweak",FF_TEXT_TWEAK:"ff_text_tweak",SENTRY_IGNORE_ERRS:["dsc.gotoAndPlay is not a function","TypeError: undefined is not a function","TypeError: 'undefined' is not an object","TypeError: Cannot read property 'pause' of null","TypeError: Cannot read property 'resume' of null","Unable to get property 'pause' of undefined or null reference","Unable to get property 'resume' of undefined or null reference","timer.pause is not a function","timer.resume is not a function","Cannot read property 'player' of undefined","undefined: TypeError: 'undefined' is not a function (evaluating 'dsc.gotoAndPlay(0)')","TypeError: Object doesn't support property or method 'gotoAndPlay'","Object [object Object] has no method 'gotoAndPlay'","Error: Not enough storage is available to complete this operation.","Cannot read property 'gotoAndPlay' of undefined","Cannot read property 'button' of undefined","Access is denied","NS_ERROR_FAILURE","この操作を完了するのに十分な記憶域がありません。"]};(function(){var logic=AdRollLiquidAds;var C=logic.CONSTANTS;var prodList=[];var recList=[];var imgsLoaded=false;var minRecs=1;var maxRecs=40;var initLoadStats={data_init:false,img_load_att:0,img_load_suc:0,valid_prods:[],valid_recs:[],invalid_recs:[],start_time:new Date,rec_load_time:null};var experiment,experimentBucket,advertisableEid;function Recommendation(data){this.data=data;this.id=data.idhash;this.clientId=data.id;this.confidence=parseFloat(data.confidence);this.url=data.url;this.source=data.source;this.imageMap={};this.textMap={};this.loading=false;this.action="";this.loadTime=new Date;this.affirmText=null;this.yotpoDisplay=null;this.resolveImageKey=function(){var prefix=this.imagePrefix;var key=prefix+"image";var stage=logic.app.getRoot()?logic.app.getStage():null;if(!stage){logic.tracking.sentryMessage("ERROR: Null stage in resolveImageKey().");return key}var stageWidth=stage.canvas.width/stage.scaleX;var stageHeight=stage.canvas.height/stage.scaleY;for(var field in this.data){if(field.search(prefix+"skyscraper")==0&&stageWidth==160&&stageHeight==600){key=prefix+"skyscraper";break}else if(field.search(prefix+"leaderboard")==0&&stageWidth==728&&stageHeight==90){key=prefix+"leaderboard";break}else if(field.search(prefix+"halfpage")==0&&stageWidth==300&&stageHeight==600){key=prefix+"halfpage";break}else if(field.search(prefix+"billboard")==0&&stageWidth==970&&stageHeight==250){key=prefix+"billboard";break}else if(field.search(prefix+"mobile")==0&&stageWidth==320&&stageHeight==50){key=prefix+"mobile";break}}return key};this.imageRetry=false;this.imagePrefix=this.data.hasOwnProperty("i/image")?"i/":"f/";this.imageKey=this.resolveImageKey();this.imageCount=1;for(var i=2;i<10;i++){if(this.data[this.imageKey+i]!=undefined){this.imageCount++}else break}if(this.data["sale_price"]!==undefined){var price=this.data["price_normalized"]||this.data["price"];var sale_price=this.data["sale_price_normalized"]||this.data["sale_price"];if(sale_price&&!price){this.data["price"]=price=this.data["sale_price"];if(this.data["sale_price_normalized"])this.data["price_normalized"]=price=this.data["sale_price_normalized"]}if(logic.utils.parse_money(sale_price)>=logic.utils.parse_money(price)){delete this.data["sale_price"];delete this.data["sale_price_normalized"]}}Recommendation.prototype.id=this.id;Recommendation.prototype.loading=this.loading;Recommendation.prototype.loadTime=this.loadTime;Recommendation.prototype.confidence=this.confidence;Recommendation.prototype.source=this.source;Recommendation.prototype.imageRetry=this.imageRetry;Recommendation.prototype.imagePrefix=this.imagePrefix;Recommendation.prototype.imageKey=this.imageKey;Recommendation.prototype.imageCount=this.imageCount;Recommendation.prototype.affirmText=this.affirmText;Recommendation.prototype.yotpoDisplay=this.yotpoDisplay;Recommendation.prototype.getRawData=function(param){return this.data[param]};Recommendation.prototype.getProductUrl=function(){if(initvars[C.PRODUCT_CLICK]!==undefined){var override=initvars[C.PRODUCT_CLICK];if(override.indexOf("http")==0){return override}if(this.data[override]!==undefined&&this.data[override].indexOf("http")==0){return this.data[override]}}else if(initvars[C.POSTFIX]!==undefined){return this.url+initvars[C.POSTFIX]}return this.url};Recommendation.prototype.getImageUrl=function(idx){var key,url;if(logic.app.isYelpAd()||logic.app.isFeatureEnabled("cachet-test")){var placement=logic.tree.getImageSize("image"+idx);key=this.data["image_url"]?"image_url":idx>1?"image"+idx:"image";var buster=initvars[C.CACHET_BUSTER]?initvars[C.CACHET_BUSTER]:"0";url=C.CACHET_IMG_PATH+logic.datamodel.getAdvertisableEid()+"/"+this.id+"/"+buster+"/"+"resize,"+Math.round(placement.width)+","+Math.round(placement.height)+"/?";if(initvars[C.PROD_GROUP_OVERRIDE])url+="groupId="+initvars[C.PROD_GROUP_OVERRIDE]+"&";url+="url="+this.data[key]}else{key=this.imageRetry?this.resolveImageKey():this.imageKey;if(idx>1)key+=idx;if(this.data[key]!==undefined){url=this.data[key]}else{url=this.data["f/image"]}}return url};Recommendation.prototype.showSalePrice=function(){if(this.data["sale_price"]!==undefined){var price=this.data["price_normalized"]||this.data["price"];var sale_price=this.data["sale_price_normalized"]||this.data["sale_price"];if(!price||!sale_price)return false;if(logic.utils.parse_money(sale_price)<logic.utils.parse_money(price)){return true}}return false};Recommendation.prototype.setImage=function(img,idx){this.imageMap[idx]=img};Recommendation.prototype.getImage=function(idx){return this.imageMap[idx]};Recommendation.prototype.setText=function(fld,props){this.textMap[fld]=props};Recommendation.prototype.getText=function(fld){return this.textMap[fld]};Recommendation.prototype.clearText=function(){return this.textMap={}};Recommendation.prototype.getPrice=function(){if(this.data["sale_price_normalized"])return parseFloat(this.data["sale_price_normalized"]);if(this.data["sale_price"])return logic.utils.parse_money(this.data["sale_price"]);if(this.data["price_normalized"])return parseFloat(this.data["price_normalized"]);if(this.data["price"])return logic.utils.parse_money(this.data["price"]);return NaN};Recommendation.prototype.setAction=function(act){this.action=act};Recommendation.prototype.getAction=function(){return this.action};Recommendation.prototype.readyToLoad=function(){return this.loading==false&&this.areAllImagesLoaded()==false};Recommendation.prototype.areAllImagesLoaded=function(){for(var i=1;i<=this.imageCount;i++){if(this.imageMap[i]===undefined){return false}}return true};Recommendation.prototype.getYotpoData=function(){var id=initvars[C.YOTPO_ID_OVERRIDE]?this.getRawData(initvars[C.YOTPO_ID_OVERRIDE]):this.getRawData("id");var tag=C.YOTPO_TAG+initvars[C.YOTPO_KEY]+"/"+id+".json";var rec=this;logic.utils.loadJSON(tag,function(data){logic.utils.log(">> YOTPO | Data successfully loaded for "+rec.id,data);rec.yotpoDisplay=data[0]},function(xhr){logic.utils.log(">> YOTPO | Error retrieving Yotpo data for "+rec.id,xhr);if(initvars.type==C.TYPE_DYNAMIC_TWA){rec.yotpoDisplay={user:"John Doe",title:"This is a sample review.",content:"Your Yotpo review content will appear here!",score:5}}else{rec.yotpoDisplay={}}},false)}}function isRecValid(data){if(data["i/image"]===undefined&&data["f/image"]===undefined){initLoadStats.invalid_recs.push(data["idhash"]);return false}if(initvars[C.PRODUCTS]!==undefined){if(initvars[C.PRODUCTS].indexOf(data["idhash"])==-1)return false}var paramName;var filterPattern=new RegExp("(include|exclude)_(.+)$","i");for(paramName in initvars){var matches=filterPattern.exec(paramName);if(matches){var action=matches[1].toLowerCase();var fieldName=matches[2].toLowerCase();var pattern=initvars[paramName];var regExp=new RegExp(pattern,"i");var value=data[fieldName];var filterMatches=regExp.test(value);if(action=="include"&&!filterMatches){logic.utils.log(">> Removing recommendation because "+value+" didn't match "+fieldName+" INCLUDE filter: "+pattern);initLoadStats.invalid_recs.push(data["idhash"]);return false}else if(action=="exclude"&&filterMatches){logic.utils.log(">> Removing recommendation because "+value+" matched "+fieldName+" EXCLUDE filter: "+pattern);initLoadStats.invalid_recs.push(data["idhash"]);return false}}}if(data["expire_at"]!=undefined){var expireDate=logic.utils.parseTimestamp(data["expire_at"]);var currentDate=logic.utils.getUTCDate(new Date);if(expireDate.getTime()<currentDate.getTime()){initLoadStats.invalid_recs.push(data["idhash"]);return false}}initLoadStats.valid_recs.push(data["idhash"]);return true}function cloneToMinimumRecs(){var numRecs=recList.length;var itemsToDupe=minRecs-numRecs;for(var i=0;i<itemsToDupe;i++){recList.push(new Recommendation(recList[i%numRecs].data))}}function onTrecsSuccess(data){var metadata=data["meta"];var service=metadata["service"]||"trecs";var optimization=metadata["optimization_target"]||"none";if(metadata.hasOwnProperty("valid_prods")){initLoadStats.valid_prods=metadata["valid_prods"]}if(metadata.hasOwnProperty("invalid_recs")){initLoadStats.invalid_recs=metadata["invalid_recs"]}if(metadata.hasOwnProperty("experiment")){experiment=metadata["experiment"]}if(metadata.hasOwnProperty("experiment_bucket")){experimentBucket=metadata["experiment_bucket"]}var trecsRecs=data["recs"];for(var index=0;index<trecsRecs.length;index++){var rec=new Recommendation(trecsRecs[index]);recList.push(rec);initLoadStats.valid_recs.push(rec.id);if(initvars[C.YOTPO_KEY]!==undefined){rec.getYotpoData()}}if(initvars[C.SET_FIRST_PRODUCT]!==undefined)setFirstProduct();if(recList.length<minRecs){cloneToMinimumRecs()}logic.tracking.logEvent(C.EVENT_TRECS_OK,{service:service,optimization:optimization});logic.utils.log(">> TRECS | Data successfully loaded.",data);return logic.utils.isTest()?recList:loadProductImages()}function onTrecsFail(data){var errorCode,errorMessage,identityProducts;var response=data.response;if(response){var parsedResponse=JSON.parse(data.response);var meta=parsedResponse.hasOwnProperty("meta")?parsedResponse["meta"]:null;if(meta){errorCode=meta["error_code"];errorMessage=meta["error_message"];experiment=meta["experiment"];experimentBucket=meta["experiment_bucket"];identityProducts=meta["products_viewed"]}}var params={};if(errorCode&&errorMessage){params={error_code:errorCode,error_message:errorMessage}}else{errorMessage="No metadata"}logic.utils.log(">> TRECS | Error: "+errorMessage+". Init fallback flow.",data);logic.tracking.logEvent(C.EVENT_TRECS_FALLBACK,params);if(identityProducts||initvars[C.PROD_GROUP_OVERRIDE]){var firstProd=identityProducts?identityProducts[0]:null;getFallbackRecs(createDefaultProduct(firstProd))}else{getProductsViewed()}}function getTrecs(advertisableEid){var sendvars={};var inclusions=[C.PROD_GROUP_OVERRIDE,C.PROD_ACT_INCLUDE_PURCH,C.PROD_ACT_EXCLUDE,C.PRODUCTS,C.INCLUDE_FILTER,C.EXCLUDE_FILTER,C.MAX_RECS,C.IDENTITY];for(var v in initvars){inclusions.forEach(function(i){if(v.indexOf(i)==0){sendvars[v]=typeof initvars[v]==="string"?logic.utils.remove_enclosure(initvars[v],"'"):initvars[v]}})}var initvarsJSON=encodeURIComponent(JSON.stringify(sendvars));var url=initvars[C.TRECS_BASE_TAG]+"?advertisable_eid="+advertisableEid+"&initvars="+initvarsJSON+"&min_products="+minRecs;if(initvars[C.COOKIE_LIST])url+="&cookie_list="+initvars[C.COOKIE_LIST];if(window.adroll_ad_payload)url+="&ad_payload="+window.adroll_ad_payload;logic.utils.loadJSON(url,onTrecsSuccess,onTrecsFail,true)}function getProductsViewed(){logic.utils.log(">> TRECS | Fallback: Hitting getv3 endpoint to fetch products viewed.");var onLoadSuccess=function(data){logic.utils.log(">> TRECS | Fallback: Successfully fetched products from getv3.",data);prodList=data["products"];getFallbackRecs(createDefaultProduct(prodList[0]))};logic.utils.loadJSON(initvars[C.PROD_TAG],onLoadSuccess,function(xhr){logic.utils.log(">> TRECS | Fallback: Call to "+url+" failed. Try to get recs from s3 with default product.",xhr);getFallbackRecs(createDefaultProduct(null))},true)}function createDefaultProduct(firstProd){var defaultProd={id:"default",group:null,action:null};if(firstProd){defaultProd.group=firstProd.hasOwnProperty("product_group")?firstProd["product_group"]:null}if(initvars[C.PROD_GROUP_OVERRIDE]!==undefined){defaultProd.group=initvars[C.PROD_GROUP_OVERRIDE]}return defaultProd}function getFallbackRecs(defaultProd){logic.utils.log(">> TRECS | Fallback: Hitting s3 endpoint to fetch default recs.");var fallbackRecsTag=C.DEFAULT_REC_PATH+advertisableEid;var url=defaultProd.group!==null?fallbackRecsTag+"/"+defaultProd.group:fallbackRecsTag;url+="/default.json";initLoadStats.valid_prods.push("default");logic.utils.loadJSON(url,onRecsLoaded,onRecsError,false)}function getYelpRecs(eid){logic.utils.log(">> YELP | Hitting s3 endpoint to fetch Yelp recs.");var url=C.YELP_DATA_TAG.replace("{eid}",eid);logic.utils.loadJSON(url,onRecsLoaded,onRecsError,false)}function onRecsError(xhr){var message=">> FAIL: Could not load default recs in trecs fallback flow.";if(logic.app.isYelpAd())message=">> FAIL: Could not load recommendation in Yelp flow.";logic.utils.log(message);logic.app.onFail(C.FAIL_LOAD_RECS,"ERROR: Rec load failure")}function onRecsLoaded(data){if(logic.app.isFailed())return;if(data.hasOwnProperty("recs"))data=data["recs"];var uniqueIdTable={};var loadTimeArray=[];for(var index=0;index<data.length;index++){var recData=data[index];if(isRecValid(recData)&&uniqueIdTable[recData.idhash]==undefined){var rec=new Recommendation(recData);recList.push(rec);uniqueIdTable[rec.id]=true;if(initvars[C.YOTPO_KEY]!==undefined){rec.getYotpoData()}if(initLoadStats.rec_load_time)loadTimeArray.push(rec.loadTime.getTime()-initLoadStats.rec_load_time.getTime())}}recList.sort(function(a,b){return b.confidence-a.confidence});if(initvars[C.SET_FIRST_PRODUCT]!==undefined)setFirstProduct();if(loadTimeArray.length>0)initLoadStats.rec_load_time=logic.utils.getMedian(loadTimeArray);var numRecs=recList.length;if(numRecs==0){logic.utils.log(">> FAIL: Not enough recs loaded in trecs fallback flow.");logic.app.onFail(C.FAIL_LOW_RECS,"ERROR: Not enough recs loaded");return}else if(numRecs<minRecs){cloneToMinimumRecs()}return logic.utils.isTest()?recList:loadProductImages()}function setFirstProduct(){for(var index=0;index<recList.length;index++){var rec=recList[index];if(rec.id==initvars[C.SET_FIRST_PRODUCT]){if(index!=0)recList.unshift(recList.splice(index,1)[0]);break}}}function loadProductImages(){if(imgsLoaded==true){checkReadyToStart();return}if(logic.app.isYelpAd()||logic.app.isFeatureEnabled("cachet-test")){logic.utils.log(">> Loading images using the cachet image service.")}var loadCount=0;var minBase=Math.max(minRecs,logic.tree.getNumImages());var loadBuffer=Math.min(minBase*2,recList.length);var loadTimeArray=[];var loadTimeMap={start:new Date};var onTransition=function(evt){var loadBatch=[];var loadIndex=0;for(var i=0;i<recList.length;i++){var rec=recList[i];if(rec.readyToLoad()==true){loadBatch.push(rec);loadIndex++;break}}loadIndex=0;for(i=recList.length-1;i>=0;i--){rec=recList[i];if(rec.readyToLoad()==true){loadBatch.push(rec);loadIndex++;if(loadIndex==loadBuffer)break}}loadBatch.forEach(loadRecImages)};var onImageLoad=function(rec,img,idx){initLoadStats.img_load_suc++;rec.setImage(img,idx);loadTimeArray.push((new Date).getTime()-loadTimeMap[rec.id].getTime());if(rec.areAllImagesLoaded()){rec.loading=false;loadCount++;logic.utils.log(">> Images loaded for "+rec.id+": "+loadCount+" of "+recList.length);if(loadCount===minRecs){checkReadyToStart();if(loadCount<recList.length){onTransition();logic.app.getRoot().addEventListener("onTransitionComplete",onTransition)}else{imgsLoaded=true}logic.tracking.logEvent(C.EVENT_IMG,{median:logic.utils.getMedian(loadTimeArray),max:Math.max.apply(null,loadTimeArray),total:(new Date).getTime()-loadTimeMap.start.getTime(),num:loadTimeArray.length})}else if(loadCount===recList.length){imgsLoaded=true;logic.app.getRoot().removeEventListener("onTransitionComplete",onTransition)}}};var onImageFail=function(rec,idx,xhr){if(rec.imageRetry==false&&rec.imagePrefix=="i/"&&!logic.app.isYelpAd()&&!logic.app.isFeatureEnabled("cachet-test")){rec.imagePrefix="f/";rec.imageRetry=true;logic.utils.log(">> ERROR: Image load failed: "+rec.id+". Retrying with f/image...");loadImage(rec,idx);return}recList.splice(recList.indexOf(rec),1);logic.utils.log(">> ERROR: Image load failed: "+rec.id);if(recList.length<minRecs){logic.utils.log(">> FAIL: Not enough images loaded.");var msg;if(logic.app.isYelpAd()||logic.app.isFeatureEnabled("cachet-test")){msg=xhr.statusText?"cachet:"+xhr.statusText:"cachet-image-error"}else{msg=xhr.response["meta"]?xhr.response.meta.error_code+":"+xhr.response.meta.errorExecMsg:"ERROR: Not enough images loaded."}logic.app.onFail(C.FAIL_LOW_PICS,msg)}};var loadImage=function(rec,idx){rec.loading=true;logic.utils.loadImage(rec.getImageUrl(idx),function(img){onImageLoad(rec,img,idx)},function(xhr){onImageFail(rec,idx,xhr)})};var loadRecImages=function(rec){if(rec.readyToLoad()==false)return;for(var i=1;i<=rec.imageCount;i++){initLoadStats.img_load_att++;loadTimeMap[rec.id]=new Date;loadImage(rec,i)}};recList.slice(0,loadBuffer).concat(recList.slice(-loadBuffer)).forEach(loadRecImages)}function checkReadyToStart(){var checkYotpoOk=function(){for(var y=0;y<=minRecs;y++){if(recList[y].yotpoDisplay==null){return false}}return true};if(initvars[C.YOTPO_KEY]!==undefined){if(checkYotpoOk()==false){var onLoadTimer=function(){if(checkYotpoOk()==true){window.clearInterval(revTimer);revTimer=null;logic.app.startDisplay()}};var revTimer=setInterval(onLoadTimer,150)}else{logic.app.startDisplay()}}else{logic.app.startDisplay()}}return AdRollLiquidAds.datamodel={init:function(){if(initLoadStats.data_init==true)return;initLoadStats.data_init=true;advertisableEid=initvars[C.ADV_EID];var minProds=logic.tree.getNumImages()==2?1:logic.tree.getNumImages();minRecs=initvars[C.MIN_RECS]!=undefined?parseInt(initvars[C.MIN_RECS]):minProds;maxRecs=initvars[C.MAX_RECS]!=undefined?parseInt(initvars[C.MAX_RECS]):maxRecs;if(maxRecs<minRecs)minRecs=maxRecs=logic.tree.getNumImages();if(initvars.type==C.TYPE_DYNAMIC_TWA){if(initvars[C.PRODUCT_DATA]!==undefined){logic.datamodel.initWithData(initvars[C.PRODUCT_DATA])}return}if(initvars[C.DYN_VIDEO]&&logic.tree.getAssetByName("image1")===undefined){imgsLoaded=true}if(initvars[C.PRODUCT_DATA]!==undefined){logic.datamodel.initWithData(initvars[C.PRODUCT_DATA])}else{logic.tracking.logEvent(C.EVENT_INIT,{});if(logic.app.isYelpAd()){getYelpRecs(advertisableEid)}else{getTrecs(advertisableEid)}}},initWithData:function(data){logic.utils.log(">> INIT: Initializing with hardcoded product data.");onRecsLoaded(data)},getProdList:function(){return prodList},getRecList:function(){return recList},getMinRecs:function(){return minRecs},getMaxRecs:function(){return maxRecs},imgLoadComplete:function(){return imgsLoaded},getInitLoadStats:function(){return initLoadStats},getAdvertisableEid:function(){return advertisableEid},getExperiment:function(){return experiment},getExperimentBucket:function(){return experimentBucket||"missing"},_test_:{onTrecsSuccess:onTrecsSuccess,onRecsLoaded:onRecsLoaded,isRecValid:isRecValid,setMinRecs:function(v){minRecs=v},clearRecList:function(){recList=[]},createRec:function(d){return new Recommendation(d)}}}})();(function(){var logic=AdRollLiquidAds;var C=logic.CONSTANTS;function Resize(widthOriginal,heightOriginal,targetWidth,targetHeight,resizeCallback){this.widthOriginal=Math.abs(parseInt(widthOriginal)||0);this.heightOriginal=Math.abs(parseInt(heightOriginal)||0);this.targetWidth=Math.abs(parseInt(targetWidth)||0);this.targetHeight=Math.abs(parseInt(targetHeight)||0);this.resizeCallback=typeof resizeCallback=="function"?resizeCallback:function(returnedArray){};this.targetWidthMultipliedByChannels=this.targetWidth*4;this.originalWidthMultipliedByChannels=this.widthOriginal*4;this.originalHeightMultipliedByChannels=this.heightOriginal*4;this.widthPassResultSize=this.targetWidthMultipliedByChannels*this.heightOriginal;this.finalResultSize=this.targetWidthMultipliedByChannels*this.targetHeight;this.initialize()}Resize.prototype.initialize=function(){if(this.widthOriginal>0&&this.heightOriginal>0&&this.targetWidth>0&&this.targetHeight>0){this.configurePasses()}};Resize.prototype.configurePasses=function(){if(this.widthOriginal==this.targetWidth){this.resizeWidth=this.bypassResizer}else{this.ratioWeightWidthPass=this.widthOriginal/this.targetWidth;if(this.ratioWeightWidthPass<1){this.initializeFirstPassBuffers(true);this.resizeWidth=this.resizeWidthInterpolatedRGBA}else{this.initializeFirstPassBuffers(false);this.resizeWidth=this.resizeWidthRGBA}}if(this.heightOriginal==this.targetHeight){this.resizeHeight=this.bypassResizer}else{this.ratioWeightHeightPass=this.heightOriginal/this.targetHeight;if(this.ratioWeightHeightPass<1){this.initializeSecondPassBuffers(true);this.resizeHeight=this.resizeHeightInterpolated}else{this.initializeSecondPassBuffers(false);this.resizeHeight=this.resizeHeightRGBA}}};Resize.prototype.resizeWidthRGBA=function(buffer){var ratioWeight=this.ratioWeightWidthPass;var ratioWeightDivisor=1/ratioWeight;var weight=0;var amountToNext=0;var actualPosition=0;var currentPosition=0;var line=0;var pixelOffset=0;var outputOffset=0;var nextLineOffsetOriginalWidth=this.originalWidthMultipliedByChannels-3;var nextLineOffsetTargetWidth=this.targetWidthMultipliedByChannels-3;var output=this.outputWidthWorkBench;var outputBuffer=this.widthBuffer;do{for(line=0;line<this.originalHeightMultipliedByChannels;){output[line++]=0;output[line++]=0;output[line++]=0;output[line++]=0}weight=ratioWeight;do{amountToNext=1+actualPosition-currentPosition;if(weight>=amountToNext){for(line=0,pixelOffset=actualPosition;line<this.originalHeightMultipliedByChannels;pixelOffset+=nextLineOffsetOriginalWidth){output[line++]+=buffer[pixelOffset++]*amountToNext;output[line++]+=buffer[pixelOffset++]*amountToNext;output[line++]+=buffer[pixelOffset++]*amountToNext;output[line++]+=buffer[pixelOffset]*amountToNext}currentPosition=actualPosition=actualPosition+4;weight-=amountToNext}else{for(line=0,pixelOffset=actualPosition;line<this.originalHeightMultipliedByChannels;pixelOffset+=nextLineOffsetOriginalWidth){output[line++]+=buffer[pixelOffset++]*weight;output[line++]+=buffer[pixelOffset++]*weight;output[line++]+=buffer[pixelOffset++]*weight;output[line++]+=buffer[pixelOffset]*weight}currentPosition+=weight;break}}while(weight>0&&actualPosition<this.originalWidthMultipliedByChannels);for(line=0,pixelOffset=outputOffset;line<this.originalHeightMultipliedByChannels;pixelOffset+=nextLineOffsetTargetWidth){outputBuffer[pixelOffset++]=output[line++]*ratioWeightDivisor;outputBuffer[pixelOffset++]=output[line++]*ratioWeightDivisor;outputBuffer[pixelOffset++]=output[line++]*ratioWeightDivisor;outputBuffer[pixelOffset]=output[line++]*ratioWeightDivisor}outputOffset+=4}while(outputOffset<this.targetWidthMultipliedByChannels);return outputBuffer};Resize.prototype.resizeWidthInterpolatedRGBA=function(buffer){var ratioWeight=this.ratioWeightWidthPass;var weight=0;var finalOffset=0;var pixelOffset=0;var firstWeight=0;var secondWeight=0;var outputBuffer=this.widthBuffer;for(var targetPosition=0;weight<1/3;targetPosition+=4,weight+=ratioWeight){for(finalOffset=targetPosition,pixelOffset=0;finalOffset<this.widthPassResultSize;pixelOffset+=this.originalWidthMultipliedByChannels,finalOffset+=this.targetWidthMultipliedByChannels){outputBuffer[finalOffset]=buffer[pixelOffset];outputBuffer[finalOffset+1]=buffer[pixelOffset+1];outputBuffer[finalOffset+2]=buffer[pixelOffset+2];outputBuffer[finalOffset+3]=buffer[pixelOffset+3]}}weight-=1/3;for(var interpolationWidthSourceReadStop=this.widthOriginal-1;weight<interpolationWidthSourceReadStop;targetPosition+=4,weight+=ratioWeight){secondWeight=weight%1;firstWeight=1-secondWeight;for(finalOffset=targetPosition,pixelOffset=Math.floor(weight)*4;finalOffset<this.widthPassResultSize;pixelOffset+=this.originalWidthMultipliedByChannels,finalOffset+=this.targetWidthMultipliedByChannels){outputBuffer[finalOffset]=buffer[pixelOffset]*firstWeight+buffer[pixelOffset+4]*secondWeight;outputBuffer[finalOffset+1]=buffer[pixelOffset+1]*firstWeight+buffer[pixelOffset+5]*secondWeight;outputBuffer[finalOffset+2]=buffer[pixelOffset+2]*firstWeight+buffer[pixelOffset+6]*secondWeight;outputBuffer[finalOffset+3]=buffer[pixelOffset+3]*firstWeight+buffer[pixelOffset+7]*secondWeight}}for(interpolationWidthSourceReadStop=this.originalWidthMultipliedByChannels-4;targetPosition<this.targetWidthMultipliedByChannels;targetPosition+=4){for(finalOffset=targetPosition,pixelOffset=interpolationWidthSourceReadStop;finalOffset<this.widthPassResultSize;pixelOffset+=this.originalWidthMultipliedByChannels,finalOffset+=this.targetWidthMultipliedByChannels){outputBuffer[finalOffset]=buffer[pixelOffset];outputBuffer[finalOffset+1]=buffer[pixelOffset+1];outputBuffer[finalOffset+2]=buffer[pixelOffset+2];outputBuffer[finalOffset+3]=buffer[pixelOffset+3]}}return outputBuffer};Resize.prototype.resizeHeightInterpolated=function(buffer){var ratioWeight=this.ratioWeightHeightPass;var weight=0;var finalOffset=0;var pixelOffset=0;var pixelOffsetAccumulated=0;var pixelOffsetAccumulated2=0;var firstWeight=0;var secondWeight=0;var outputBuffer=this.heightBuffer;for(;weight<1/3;weight+=ratioWeight){for(pixelOffset=0;pixelOffset<this.targetWidthMultipliedByChannels;){outputBuffer[finalOffset++]=Math.round(buffer[pixelOffset++])}}weight-=1/3;for(var interpolationHeightSourceReadStop=this.heightOriginal-1;weight<interpolationHeightSourceReadStop;weight+=ratioWeight){secondWeight=weight%1;firstWeight=1-secondWeight;pixelOffsetAccumulated=Math.floor(weight)*this.targetWidthMultipliedByChannels;pixelOffsetAccumulated2=pixelOffsetAccumulated+this.targetWidthMultipliedByChannels;for(pixelOffset=0;pixelOffset<this.targetWidthMultipliedByChannels;++pixelOffset){outputBuffer[finalOffset++]=Math.round(buffer[pixelOffsetAccumulated++]*firstWeight+buffer[pixelOffsetAccumulated2++]*secondWeight)}}while(finalOffset<this.finalResultSize){for(pixelOffset=0,pixelOffsetAccumulated=interpolationHeightSourceReadStop*this.targetWidthMultipliedByChannels;pixelOffset<this.targetWidthMultipliedByChannels;++pixelOffset){outputBuffer[finalOffset++]=Math.round(buffer[pixelOffsetAccumulated++])}}return outputBuffer};Resize.prototype.resizeHeightRGBA=function(buffer){var ratioWeight=this.ratioWeightHeightPass;var ratioWeightDivisor=1/ratioWeight;var weight=0;var amountToNext=0;var actualPosition=0;var currentPosition=0;var pixelOffset=0;var outputOffset=0;var output=this.outputHeightWorkBench;var outputBuffer=this.heightBuffer;do{for(pixelOffset=0;pixelOffset<this.targetWidthMultipliedByChannels;){output[pixelOffset++]=0;output[pixelOffset++]=0;output[pixelOffset++]=0;output[pixelOffset++]=0}weight=ratioWeight;do{amountToNext=1+actualPosition-currentPosition;if(weight>=amountToNext){for(pixelOffset=0;pixelOffset<this.targetWidthMultipliedByChannels;){output[pixelOffset++]+=buffer[actualPosition++]*amountToNext;output[pixelOffset++]+=buffer[actualPosition++]*amountToNext;output[pixelOffset++]+=buffer[actualPosition++]*amountToNext;output[pixelOffset++]+=buffer[actualPosition++]*amountToNext}currentPosition=actualPosition;weight-=amountToNext}else{for(pixelOffset=0,amountToNext=actualPosition;pixelOffset<this.targetWidthMultipliedByChannels;){output[pixelOffset++]+=buffer[amountToNext++]*weight;output[pixelOffset++]+=buffer[amountToNext++]*weight;output[pixelOffset++]+=buffer[amountToNext++]*weight;output[pixelOffset++]+=buffer[amountToNext++]*weight}currentPosition+=weight;break}}while(weight>0&&actualPosition<this.widthPassResultSize);for(pixelOffset=0;pixelOffset<this.targetWidthMultipliedByChannels;){outputBuffer[outputOffset++]=Math.round(output[pixelOffset++]*ratioWeightDivisor);outputBuffer[outputOffset++]=Math.round(output[pixelOffset++]*ratioWeightDivisor);outputBuffer[outputOffset++]=Math.round(output[pixelOffset++]*ratioWeightDivisor);outputBuffer[outputOffset++]=Math.round(output[pixelOffset++]*ratioWeightDivisor)}}while(outputOffset<this.finalResultSize);return outputBuffer};Resize.prototype.resize=function(buffer){this.resizeCallback(this.resizeHeight(this.resizeWidth(buffer)))};Resize.prototype.bypassResizer=function(buffer){return buffer};Resize.prototype.initializeFirstPassBuffers=function(BILINEARAlgo){this.widthBuffer=this.generateFloatBuffer(this.widthPassResultSize);if(!BILINEARAlgo){this.outputWidthWorkBench=this.generateFloatBuffer(this.originalHeightMultipliedByChannels)}};Resize.prototype.initializeSecondPassBuffers=function(BILINEARAlgo){this.heightBuffer=this.generateUint8Buffer(this.finalResultSize);if(!BILINEARAlgo){this.outputHeightWorkBench=this.generateFloatBuffer(this.targetWidthMultipliedByChannels)}};Resize.prototype.generateFloatBuffer=function(bufferLength){try{return new Float32Array(bufferLength)}catch(error){return[]}};Resize.prototype.generateUint8Buffer=function(bufferLength){try{return new Uint8Array(bufferLength)}catch(error){return[]}};return AdRollLiquidAds.processing={resize_image:function(img,scale){var srcCanvas=document.createElement("canvas"),srcContext=srcCanvas.getContext("2d");srcCanvas.width=img.width;srcCanvas.height=img.height;srcContext.drawImage(img,0,0,img.width,img.height,0,0,img.width,img.height);var dataToScale=srcContext.getImageData(0,0,img.width,img.height).data;var destCanvas=document.createElement("canvas"),destContext=destCanvas.getContext("2d");destCanvas.width=img.width*scale;destCanvas.height=img.height*scale;var updateCanvas=function(ctx,imgBuffer,frameBuffer){var data=imgBuffer.data;var length=data.length;for(var x=0;x<length;++x){data[x]=frameBuffer[x]&255}ctx.putImageData(imgBuffer,0,0)};var resizeLogic=new Resize(img.width,img.height,destCanvas.width,destCanvas.height,function(buffer){updateCanvas(destContext,destContext.createImageData(destCanvas.width,destCanvas.height),buffer)});resizeLogic.resize(dataToScale);return destCanvas},sharpen_image:function(cvs,mix){var weights=[0,-1,0,-1,5,-1,0,-1,0],ctx=cvs.getContext("2d"),katet=Math.round(Math.sqrt(weights.length)),half=katet*.5|0,w=cvs.width,h=cvs.height,dstData=ctx.createImageData(w,h),dstBuff=dstData.data,srcBuff=ctx.getImageData(0,0,w,h).data,y=h,x;while(y--){x=w;while(x--){var sy=y,sx=x,dstOff=(y*w+x)*4,r=0,g=0,b=0,a=0;for(var cy=0;cy<katet;cy++){for(var cx=0;cx<katet;cx++){var scy=sy+cy-half;var scx=sx+cx-half;if(scy>=0&&scy<h&&scx>=0&&scx<w){var srcOff=(scy*w+scx)*4;var wt=weights[cy*katet+cx];r+=srcBuff[srcOff]*wt;g+=srcBuff[srcOff+1]*wt;b+=srcBuff[srcOff+2]*wt;a+=srcBuff[srcOff+3]*wt}}}dstBuff[dstOff]=r*mix+srcBuff[dstOff]*(1-mix);dstBuff[dstOff+1]=g*mix+srcBuff[dstOff+1]*(1-mix);dstBuff[dstOff+2]=b*mix+srcBuff[dstOff+2]*(1-mix);dstBuff[dstOff+3]=srcBuff[dstOff+3]}}ctx.putImageData(dstData,0,0)},resolveTextSize:function(field,textValue){var testField=field.clone();var fieldName=logic.utils.stripAssetIndex(field.name);var minSize=9;var truncateAfterMin=false;if(initvars[C.MIN_FONT_FIELDS]&&initvars[C.MIN_FONT_FIELDS][fieldName]){minSize=initvars[C.MIN_FONT_FIELDS][fieldName].minSize;truncateAfterMin=true}var checkResizeText=function(){try{var metrics=field.getMetrics()}catch(err){logic.tracking.sentryException(err,{tags:{field:field.font,action:"get_metrics"}});return}var shrinkPointSize=function(){var pointSize=parseFloat(logic.utils.parse_px(field.font));field.font=field.font.replace(pointSize,pointSize-1);logic.utils.log(">> "+field.name+":: Shrunk point size: "+pointSize+" to "+(pointSize-1));return pointSize-1};var fieldHeight=field["designProps"]?field["designProps"].height:field["designHeight"]||metrics.height;var hasJapaneseChars=logic.utils.hasJapaneseCharacters(textValue);if(metrics.width>field.lineWidth||hasJapaneseChars&&field.name.indexOf("price")<0){var pointSize=parseFloat(logic.utils.parse_px(field.font));var charsPerRow=Math.floor(100/pointSize)*(metrics.width/100);var numRows=Math.ceil(fieldHeight/(pointSize*1.25));if(!hasJapaneseChars||textValue.length>Math.round(charsPerRow*numRows)){var size=shrinkPointSize();if(size>minSize){return checkResizeText()}}if(fieldHeight<pointSize*1.75&&(!hasJapaneseChars||field.name.indexOf("price")>=0)){field.maxWidth=field.lineWidth}else{testField.text="";var fieldPointSize=parseFloat(logic.utils.parse_px(field.font));var testFieldPointSize=parseFloat(logic.utils.parse_px(testField.font));testField.font=testField.font.replace(testFieldPointSize,fieldPointSize-1);if(testField.getMetrics().width<testField.lineWidth){if(hasJapaneseChars){testField.text+=String.fromCharCode(12366)}else{testField.text+="W"}}var lineLength=Math.floor(testField.lineWidth/testField.getMetrics().width);var lineList=[];if(textValue.indexOf("\n")==-1){var cursorIdx=0;while(cursorIdx<textValue.length&&(numRows==1||lineList.length<numRows-1)){var lengthTarget=cursorIdx+lineLength;var breakChars=["-","/","_","+","—"," "];for(var index=0;index<breakChars.length;index++){var breakChar=breakChars[index];if(textValue.indexOf(breakChar,cursorIdx)!=-1&&logic.utils.is_num_in_range(textValue.indexOf(breakChar,cursorIdx),lengthTarget,2)){lengthTarget=textValue.indexOf(breakChar,cursorIdx);break}}lineList.push(textValue.slice(cursorIdx,lengthTarget));cursorIdx+=lineLength}}else{lineList=textValue.split("\n")}textValue=lineList.join("\n");field.text=textValue}}var resolveTextHeight=function(){if(field.getMetrics().height>fieldHeight){var size=shrinkPointSize();if(size>minSize){return resolveTextHeight()}else if(truncateAfterMin==true){var pointSize=parseFloat(logic.utils.parse_px(testField.font));testField.font=testField.font.replace(pointSize,minSize);testField.text="";var charLength;if(initvars[C.MIN_FONT_FIELDS][fieldName].length){charLength=initvars[C.MIN_FONT_FIELDS][fieldName].length}else{var charIndex=0;while(testField.getMetrics().height<fieldHeight){testField.text+=textValue.charAt(charIndex);charIndex++}charLength=charIndex}logic.utils.log(">> Truncating "+fieldName+" at "+charLength+" chars.");field.text=logic.processing.truncateText(textValue,charLength);return}}};resolveTextHeight()};checkResizeText()},truncateText:function(textValue,textLength){var words=textValue.split(" ");var newTextValue="";for(var currentWord=0;currentWord<words.length;currentWord++){if(newTextValue.length+words[currentWord].length+1<textLength){newTextValue+=words[currentWord]+" "}else break}newTextValue=newTextValue.trim();textValue=newTextValue.substr(0,newTextValue.length)+(newTextValue<textValue?"...":"");return textValue},scanTimeline:function(node,mapAsset){for(var index=0;index<node.numChildren;index++){var obj=node.getChildAt(index);var isCustomizable=false;if(!obj.name)continue;if(obj instanceof logic.createJS.MovieClip||obj instanceof logic.createJS.Container){if(obj.name.indexOf("image")!=-1){}else{if(obj["useAsButton"])logic.timeline.customButton(obj);if(logic.utils.stripAssetIndex(obj.name)=="button"||logic.utils.stripAssetIndex(obj.name)=="text"){if(logic.touch)logic.touch.product(obj);obj.tickEnabled=obj.tickChildren=false}else if(obj.hitArea||obj["useAsButton"]){if(logic.touch)logic.touch.nav(obj);if(!obj["useAsButton"])obj.tickEnabled=obj.tickChildren=false}}if(obj.shape&&obj.shape["drawPath"]){logic.utils.log(">> Customizable shape found in: "+obj.name+" "+obj);isCustomizable=true}mapAsset(obj,isCustomizable);logic.processing.scanTimeline(obj,mapAsset)}else if(obj instanceof logic.createJS.Text){obj.set({fieldId:"_"+Math.random().toFixed(5)});var families=logic.utils.getWebFontFamilies();if(families!=null){var setFont=function(fld,wt,fam){if(fld.font.toLowerCase().indexOf("italic")!=-1){wt+=" italic"}fld.font=wt+" "+logic.utils.parse_px(fld.font)+"px "+"'"+fam+"'";fld.set({designFont:fld.font})};for(var f=0;f<families.length;f++){var family=families[f].split(":");if(!family[1]||obj["designFont"])continue;var raw=obj.font.indexOf("'")!=-1?obj.font.match(/'(.*?)'/)[1]:obj.font;var name=family[0].replace(/\+/g," ");var weights=family[1].split(",");if(initvars[C.FONT_MAP]!==undefined&&initvars[C.FONT_MAP][raw]!==undefined){setFont(obj,initvars[C.FONT_MAP][raw].slice(0,3),name)}else if(obj.font.toLowerCase().indexOf(name.toLowerCase())!=-1){var getWeight=function(wts){var len=wts.length;for(var i=0;i<len;i++){if(logic.utils.array_contains(weights,wts[i]))return wts[i]}return null};var weight=null;if(obj.font.toLowerCase().indexOf("thin")!=-1||obj.font.toLowerCase().indexOf("extra light")!=-1||obj.font.toLowerCase().indexOf("extra-light")!=-1){weight=getWeight(["100","200"])}else if(obj.font.toLowerCase().indexOf("light")!=-1){weight=getWeight(["200","300"])}else if(obj.font.toLowerCase().indexOf("black")!=-1||obj.font.toLowerCase().indexOf("heavy")!=-1){weight=getWeight(["800","900"])}else if(obj.font.toLowerCase().indexOf("semibold")!=-1||obj.font.toLowerCase().indexOf("medium")!=-1){weight=getWeight(["500","600"])}else if(obj.font.toLowerCase().indexOf("bold")!=-1){weight=getWeight(["700","800","900"])}if(!weight)weight="400";setFont(obj,weight,name)}}logic.utils.log(">> Set custom font for "+obj.name+obj["fieldId"]+": "+obj.font)}else{obj.set({designFont:obj.font})}var xTweak=0;var yTweak=.1;var userAgent=logic.utils.getUserAgent();var tweaks=[{t:C.TEXT_TWEAK_CHR,a:"chrome"},{t:C.TEXT_TWEAK_EDG,a:"edge"},{t:C.TEXT_TWEAK_FF,a:"firefox"},{t:C.TEXT_TWEAK_SAF,a:"safari"},{t:C.TEXT_TWEAK_BRV,a:"brave"}];for(var x=0;x<tweaks.length;x++){var config=tweaks[x];if(initvars[config.t]!==undefined&&userAgent==config.a){xTweak=parseFloat(initvars[config.t].substring(0,initvars[config.t].indexOf(",")));yTweak=parseFloat(initvars[config.t].substring(initvars[config.t].indexOf(",")+1));logic.utils.log(">> Applying "+config.a+" text tweak for "+obj.name+" by ("+xTweak+", "+yTweak+")")}}if(xTweak!==undefined)obj.x+=obj.lineHeight*xTweak;if(yTweak!==undefined)obj.y+=obj.lineHeight*yTweak;if(initvars[C.TEXT_COLOR_OVERRIDE+logic.utils.stripAssetIndex(obj.name)]){obj.color="#"+initvars[C.TEXT_COLOR_OVERRIDE+logic.utils.stripAssetIndex(obj.name)]}if(!obj["designFont"])obj.set({designFont:obj.font});mapAsset(obj);obj.tickEnabled=obj.tickChildren=false}}}}})();(function(){var logic=AdRollLiquidAds;var C=logic.CONSTANTS;var assetMap=[];var numImages=0;var customizable=[];var imageIndexList=[];var videoIndexList=[];var imageSizeMap={};var badgeMap;function checkForStaticText(obj){return obj instanceof logic.createJS.Text&&initvars[C.TEXT_OVERRIDE+obj.name]!==undefined}function placeImage(cont,rec,img,idx){var imageIndex=idx||1;if(cont.name.indexOf("_")!=-1){if(rec.imageCount>1){imageIndex=parseFloat(cont.name.substring(cont.name.indexOf("_")+1));cont.visible=true}else{cont.visible=false;return}}if(cont.numChildren>0)cont.removeChildAt(0);var image=img||rec.getImage(imageIndex);if(!image)return;var bitmap;if(image instanceof HTMLImageElement){bitmap=logic.tree.setImage(image,cont);rec.setImage(bitmap,imageIndex)}else{bitmap=image.clone()}cont.addChild(bitmap)}function placeVideo(cont,rec){var assetIndex=logic.utils.getAssetIndex(cont.name);if(assetIndex!=1)return;if(cont.productVideo){logic.app.getRoot().removeEventListener("onAnimationTimerComplete",cont.productVideo.onAnimComplete);cont.removeAllChildren();cont.productVideo.preloader.clear();cont.productVideo.video.shutdown();cont.productVideo.video=null}cont.productVideo={};cont.productVideo.onVideoError=function(evt){if(cont.productVideo.video){cont.productVideo.video.shutdown();cont.productVideo.video=null}if(rec.getImage(assetIndex)!==undefined){placeImage(cont,rec);return}var imgUrl=initvars[C.DYN_VIDEO_IMG]?rec.getRawData(initvars[C.DYN_VIDEO_IMG]):rec.getImageUrl(assetIndex);logic.utils.loadImage(imgUrl,function(img){rec.setImage(img,assetIndex);placeImage(cont,rec)},function(xhr){logic.app.onFail(C.FAIL_LOW_PICS,"ERROR: Could not load video or backup image.")})};cont.productVideo.onVideoLoaded=function(evt){var source=cont.productVideo.video.getHtml();var bitmap=new logic.createJS.Bitmap(source.element);var scale=Math.min(cont.nominalBounds.width/source.element.videoWidth,cont.nominalBounds.height/source.element.videoHeight);bitmap.scaleX=bitmap.scaleY=scale;cont.productVideo.preloader.deactivate();cont.productVideo.video.play();var player=cont.getChildByName("player")?cont.getChildByName("player"):cont;player.mouseEnabled=player.mouseChildren=false;player.removeAllChildren();player.addChildAt(bitmap,0);logic.app.pauseAnimation();var event=new logic.createJS.Event("onDynamicVideoStart");event.videoLogic=cont.productVideo.video;logic.app.getRoot().dispatchEvent(event)};cont.productVideo.onVideoComplete=function(evt){var event=new logic.createJS.Event("onDynamicVideoComplete");event.videoLogic=cont.productVideo.video;logic.app.getRoot().dispatchEvent(event);logic.app.resumeAnimation()};if(logic.app.isMobile()){cont.productVideo.onVideoError(null);return}cont.productVideo.video=logic.utils.createVideoPlacement(rec.getRawData(initvars[C.DYN_VIDEO]),cont.nominalBounds.width,cont.nominalBounds.height,false);cont.productVideo.onAnimComplete=function(e){if(cont.productVideo.video){cont.productVideo.video.loadImage()}};logic.app.getRoot().addEventListener("onAnimationTimerComplete",cont.productVideo.onAnimComplete);cont.productVideo.video.id="liquidAdVideo"+assetIndex;cont.productVideo.video.onError=cont.productVideo.onVideoError;cont.productVideo.video.onLoaded=cont.productVideo.onVideoLoaded;cont.productVideo.video.onComplete=cont.productVideo.onVideoComplete;cont.productVideo.video.data=rec;cont.productVideo.video.loadImage=function(){if(!initvars[C.DYN_VIDEO_IMG])return;var prefix=rec.resolveImagePrefix();var url=rec.getRawData(prefix+initvars[C.DYN_VIDEO_IMG])||rec.getRawData(initvars[C.DYN_VIDEO_IMG])||rec.getRawData(prefix+"image");logic.utils.loadImage(url,function(img){placeImage(cont,rec,img)},function(xhr){logic.utils.log("ERROR: Could not manually load backup image.")})};cont.productVideo.preloader=logic.preloader.create(cont);cont.productVideo.preloader.bkgrd=cont.productVideo.preloader.border=false;cont.productVideo.preloader.activate();cont.productVideo.video.init()}function placeText(field,textValue){var fieldName=logic.utils.stripAssetIndex(field.name);if(initvars[C.ALL_CAPS]!==undefined){var capsFieldArray=initvars[C.ALL_CAPS].split(",");if(capsFieldArray.indexOf(fieldName)!=-1){textValue=textValue.toUpperCase()}}else if(initvars[C.TITLE_CASE]!==undefined){var titleCaseFieldArray=initvars[C.TITLE_CASE].split(",");if(titleCaseFieldArray.indexOf(fieldName)!=-1){textValue=logic.utils.toTitleCase(textValue)}}field.font=field["designFont"];field.text=logic.utils.decode_html(textValue);try{logic.processing.resolveTextSize(field,textValue)}catch(err){logic.tracking.sentryException(err,{tags:{field:field.font,action:"resolve_text_size"}})}}function setText(field,rec){if(!rec)return;var fieldName=logic.utils.stripAssetIndex(field.name);var fieldId=field["fieldId"];if(!fieldId)field["fieldId"]="_"+Math.random().toFixed(5);var fldProps=rec.getText(fieldName+fieldId);if(fldProps){field.font=fldProps.font;field.text=fldProps.text}else{var textValue=checkForStaticText(field)?logic.utils.decode_html(initvars[C.TEXT_OVERRIDE+field.name]):rec.getRawData(fieldName);if(textValue===undefined||textValue===null){if(fieldName===C.PERCENT_OFF){if(rec.data["sale_price_normalized"]&&rec.data["price_normalized"]&&parseFloat(rec.data["sale_price_normalized"])<parseFloat(rec.data["price_normalized"])){var percentOff=100*(1-parseFloat(rec.data["sale_price_normalized"])/parseFloat(rec.data["price_normalized"]));percentOff=percentOff.toFixed(0);if(initvars[C.PERCENT_OFF]===undefined||initvars[C.PERCENT_OFF].indexOf("[percent_off]")===-1){textValue=percentOff+"%";if(initvars.type==C.TYPE_DYNAMIC_TWA)textValue+=" OFF"}else{textValue=initvars[C.PERCENT_OFF].replace("[percent_off]",percentOff)}}else{textValue=""}}else if(initvars[C.AFFIRM_KEY]!==undefined&&fieldName==C.AFFIRM_TEXT){if(rec.getPrice()<C.AFFIRM_MIN){textValue=rec.affirmText="ERROR price under minimum"}else if(rec.affirmText){textValue=rec.affirmText}else{getAffirmText(field,rec);return}}else if([C.YOTPO_USER,C.YOTPO_TITLE,C.YOTPO_CONTENT].indexOf(fieldName)!=-1){if(rec.yotpoDisplay){switch(fieldName){case C.YOTPO_USER:textValue=rec.yotpoDisplay["user"];break;case C.YOTPO_TITLE:textValue=rec.yotpoDisplay["title"];break;case C.YOTPO_CONTENT:textValue=rec.yotpoDisplay["content"];break}}if(!textValue){if(!rec.yotpoDisplay)return;textValue=""}}else{textValue=""}}if(initvars[C.TEXT_OVERRIDE+fieldName]!==undefined){textValue=initvars[C.TEXT_OVERRIDE+fieldName]}else if(initvars[C.FIELD_EXTENSION]!==undefined&&rec.getRawData(fieldName+initvars[C.FIELD_EXTENSION])!==undefined){textValue=rec.getRawData(fieldName+initvars[C.FIELD_EXTENSION])}if(fieldName=="cta_text"&&textValue==""&&initvars[C.YELP_DEFAULT_CTA]){textValue=initvars[C.YELP_DEFAULT_CTA]}if(initvars[C.MAX_TITLE_FIELDS]!==undefined){var fieldMap=initvars[C.MAX_TITLE_FIELDS];if(fieldMap[fieldName]){logic.utils.log(">> Truncating "+fieldName+" at "+fieldMap[fieldName]+" chars.");textValue=logic.processing.truncateText(textValue,fieldMap[fieldName])}}placeText(field,textValue);rec.setText(fieldName+fieldId,{font:field.font,text:field.text})}field.visible=resolveVisibility(field,-1);if(fieldName==C.AFFIRM_TEXT){field.parent.visible=rec.getPrice()>=C.AFFIRM_MIN}var showSlash=function(show){var slash=field.parent?field.parent.slash:null;if(slash!==null&&slash!==undefined){slash.visible=show}};var hideField=function(){field.visible=false;showSlash(false);field.text=""};if(fieldName===C.PRICE){if(initvars[C.SALE_PRICE_OPTION]){if(initvars[C.SALE_PRICE_OPTION]===C.SALE_PRICE_OPTION_NONE){hideField()}else if(initvars[C.SALE_PRICE_OPTION]===C.SALE_PRICE_OPTION_PRICE){if(rec.showSalePrice()){hideField()}}else{showSlash(true)}}else{if(rec.showSalePrice()==false){showSlash(false);field.visible=true}else if(initvars[C.SALE_PRICE]==="remove_original"){hideField()}else if(initvars[C.SALE_PRICE]!==undefined){showSlash(logic.utils.getBool(initvars[C.SALE_PRICE]))}}}else if(fieldName===C.SALE_PRICE){if(initvars[C.SALE_PRICE_OPTION]){if(field.originalXPosition)field.x=field.originalXPosition;if(field.originalYPosition)field.y=field.originalYPosition;if(initvars[C.SALE_PRICE_OPTION]===C.SALE_PRICE_OPTION_NONE){hideField()}else if(initvars[C.SALE_PRICE_OPTION]===C.SALE_PRICE_OPTION_PRICE){showSlash(false);if(rec.showSalePrice()){if(!field.originalXPosition)field.originalXPosition=field.x;if(!field.originalYPosition)field.originalYPosition=field.y;if(field.parent&&field.parent.price){var priceObj=field.parent.price;priceObj.visible=false;field.x=priceObj.x;field.y=priceObj.y}}else{field.visible=false}}else{if(!rec.showSalePrice()){hideField()}}}else{if((logic.utils.getBool(initvars[C.SALE_PRICE])==false||rec.showSalePrice()==false)&&initvars[C.SALE_PRICE]!="remove_original"){hideField()}else if(rec.showSalePrice()==true){field.visible=true}}}else if(fieldName===C.PERCENT_OFF){var visible=initvars[C.SALE_PRICE_OPTION]?initvars[C.SALE_PRICE_OPTION]==C.SALE_PRICE_OPTION_PERCENT_OFF:initvars[C.PERCENT_OFF];if(visible)visible=field.text!="";var percentOffParent=field.parent;if(percentOffParent){percentOffParent.visible=visible;for(var i=0;i<percentOffParent.children.length;i++){percentOffParent.children[i].visible=visible}}field.visible=visible}if(field.parent)field.parent.dispatchEvent(new logic.createJS.Event("onSetDynamicText"))}function getAffirmText(field,rec){var tag=C.AFFIRM_TAG+initvars[C.AFFIRM_KEY];var apr=initvars[C.AFFIRM_APR]?initvars[C.AFFIRM_APR]:C.AFFIRM_DEFAULT_APR;var term=initvars[C.AFFIRM_TERM]?initvars[C.AFFIRM_TERM]:C.AFFIRM_DEFAULT_TERM;var price=rec.getPrice();var decimals=logic.utils.decimal_places(price);if(decimals==0){price=price+"00"}else if(decimals==1){price=price+"0"}else{price=price.toFixed(2).toString()}price=price.replace(/\./g,"");logic.utils.loadJSON(tag+"/"+apr+"/"+price+"/"+term,function(data){logic.utils.log(">> AFFIRM | Data successfully loaded for "+rec.id,data);if(!initvars[C.AFFIRM_TEXT])initvars[C.AFFIRM_TEXT]="Pay as low as $[payment]/month";rec.affirmText=logic.utils.replaceWildcards(initvars[C.AFFIRM_TEXT],"[payment]",data["payment_string"]);setText(field,rec)},function(xhr){rec.affirmText="ERROR retrieving Affirm data!";setText(field,rec)},true)}function getYotpoDisplay(mc,rec){var displayReview=function(){if(mc[C.YOTPO_USER])setText(mc[C.YOTPO_USER],rec);if(mc[C.YOTPO_TITLE])setText(mc[C.YOTPO_TITLE],rec);if(mc[C.YOTPO_CONTENT])setText(mc[C.YOTPO_CONTENT],rec);if(mc[C.YOTPO_RATING])mc[C.YOTPO_RATING].gotoAndStop(rec.yotpoDisplay["score"]-1);mc.visible=true};if(rec.yotpoDisplay&&rec.yotpoDisplay["score"]){displayReview()}else{mc.visible=false}}function resolveVisibility(displayObj,assetIndex){var assetName=logic.utils.stripAssetIndex(displayObj.name);var showOverride=initvars[C.SHOW_OVERRIDE+assetName];var objName=logic.utils.getAssetIndex(displayObj.name)==-1?displayObj.name+logic.utils.getParentIndex(displayObj):displayObj.name;var visible=displayObj.visible;if(showOverride!==undefined){if(showOverride=="true"||showOverride=="false"||showOverride==true||showOverride==false){visible=logic.utils.getBool(showOverride)}else if(logic.utils.getAssetIndex(objName)==assetIndex){var testString=showOverride.charAt(0)=="!"?showOverride.substring(1):showOverride;if(displayObj.rec.getRawData(testString)===undefined||displayObj.rec.getRawData(testString)===""){visible=showOverride=="!"+testString?true:false}else{visible=showOverride=="!"+testString?false:true}}}if(assetName==initvars[C.YELP_GOOD_BIZ]||assetName==initvars[C.YELP_WEAK_BIZ]){var rating=parseFloat(displayObj.rec.getRawData("rating"));var threshold=initvars[C.RATING_MIN]?parseFloat(initvars[C.RATING_MIN]):1;visible=assetName==initvars[C.YELP_GOOD_BIZ]?true:false;if(isNaN(rating)||rating<threshold){visible=assetName==initvars[C.YELP_GOOD_BIZ]?false:true}if(displayObj.getChildByName("verified")&&displayObj.getChildByName("notverified")){var isVerified=logic.utils.getBool(displayObj.rec.getRawData("has_active_verified_license"));displayObj.getChildByName("verified").visible=isVerified;displayObj.getChildByName("notverified").visible=!isVerified}if(displayObj.getChildByName("response")){displayObj.getChildByName("response").visible=displayObj.rec.getRawData("response_time")!=undefined}}return visible}return AdRollLiquidAds.tree={discover:function(root){logic.utils.nameChildren(root);if(initvars[C.FONT_MAP]!==undefined){var data=initvars[C.FONT_MAP].split(",");var map=[];for(var i=0;i<data.length;i++){var m=data[i].split(":");map[m[0]]=m[1]}initvars[C.FONT_MAP]=map}logic.processing.scanTimeline(root,logic.tree.mapAsset);numImages=imageIndexList.length>0?imageIndexList.length:videoIndexList.length;imageIndexList=videoIndexList=null;if(root.getChildByName("bkgrd")){assetMap["bkgrd"]=root.getChildByName("bkgrd")}if(root.getChildByName("video")&&(logic.app.isMobile()==true||!initvars[C.VIDEO_TAG])){root.getChildByName("video").visible=false}if(initvars[C.MAX_TITLE_FIELDS]!==undefined){initvars[C.MAX_TITLE_FIELDS]=initvars[C.MAX_TITLE_FIELDS].split(",")}else if(root["maxTitleFields"]!==undefined){initvars[C.MAX_TITLE_FIELDS]=root["maxTitleFields"]}if(initvars[C.MAX_TITLE_FIELDS]){initvars[C.MAX_TITLE_FIELDS]=logic.utils.parseValueStringList(initvars[C.MAX_TITLE_FIELDS])}if(initvars[C.MIN_FONT_FIELDS]!==undefined){if(typeof initvars[C.MIN_FONT_FIELDS]=="string"){initvars[C.MIN_FONT_FIELDS]=JSON.parse(initvars[C.MIN_FONT_FIELDS])}}if(initvars[C.BADGE_ID]!==undefined){logic.tree.loadBusinessBadge()}var onAnimTimerComplete=function(evt){root.removeEventListener("onAnimationTimerComplete",onAnimTimerComplete);for(var prop in assetMap){var assetArray=assetMap[prop];for(var i=0;i<assetArray.length;i++){if(assetArray[i]instanceof logic.createJS.MovieClip){assetArray[i].stop()}}}};root.addEventListener("onAnimationTimerComplete",onAnimTimerComplete)},mapAsset:function(obj,isCustomizable){if(obj.name===null)return;if(isCustomizable)customizable.push(obj);var assetIndex=logic.utils.getAssetIndex(obj.name);var mapId=obj.name;if(assetIndex==-1&&obj.name!="slash"&&checkForStaticText(obj)==false){assetIndex=logic.utils.getParentIndex(obj);if(assetIndex!=-1){mapId=obj.name+assetIndex;if(obj.name.indexOf("image")!=-1&&obj.name.indexOf("_")!=-1){mapId=logic.utils.stripAssetIndex(obj.name)+assetIndex+obj.name.substr(obj.name.indexOf("_"))}}}if(assetIndex!=-1){if(assetMap[assetIndex]===undefined)assetMap[assetIndex]=[];assetMap[assetIndex].push(obj);if(obj.name.indexOf("image")!=-1){if(obj.name.indexOf("_")==-1&&imageIndexList.indexOf(assetIndex)==-1){imageIndexList.push(assetIndex)}var pn=obj.name.indexOf("_")!=-1?"image"+assetIndex:"image1";var pw=imageSizeMap[pn]?Math.max(imageSizeMap[pn].width,obj.nominalBounds.width):obj.nominalBounds.width;var ph=imageSizeMap[pn]?Math.max(imageSizeMap[pn].height,obj.nominalBounds.height):obj.nominalBounds.height;imageSizeMap[pn]={width:pw,height:ph}}else if(obj.name.indexOf("video")!=-1&&videoIndexList.indexOf(assetIndex)==-1){videoIndexList.push(assetIndex)}}else{obj.visible=resolveVisibility(obj,-1)}if(assetMap[mapId]===undefined)assetMap[mapId]=[];assetMap[mapId].push(obj);logic.utils.log(">> MAP ASSET: "+mapId+" "+obj)},populate:function(aindex,rec){if(!rec)return;var assetArray=assetMap[aindex];var textWidth=0,textHeight=0;var checkVisibility=true;for(var index=0;index<assetArray.length;index++){var displayObj=assetArray[index];if(displayObj instanceof logic.createJS.Container&&(displayObj.name.indexOf("image")!=-1||initvars[C.DYN_VIDEO]&&displayObj.name.indexOf("video")!=-1)){if(displayObj.name.indexOf("image")!=-1){if(!logic.timeline.getInstance("slideshow")){placeImage(displayObj,rec);displayObj.cache(0,0,displayObj.nominalBounds.width,displayObj.nominalBounds.height)}}else{placeVideo(displayObj,rec)}}else if(initvars[C.YOTPO_KEY]!==undefined&&displayObj.name.indexOf(C.YOTPO_REVIEW)!=-1){getYotpoDisplay(displayObj,rec)}else if(displayObj instanceof logic.createJS.MovieClip&&displayObj.name.indexOf("rating")==0){var rating=parseFloat(rec.getRawData("rating"));var threshold=initvars[C.RATING_MIN]?parseFloat(initvars[C.RATING_MIN]):1;checkVisibility=false;if(isNaN(rating)||rating<threshold){displayObj.visible=false}else if(initvars[C.RATING_SCALE]=="custom"&&displayObj["setRating"]){displayObj["setRating"](rating);displayObj.visible=true}else{if(initvars[C.RATING_SCALE]=="half")rating=rating/.5;displayObj.gotoAndStop(Math.ceil(rating)-1);displayObj.visible=true}}else if(displayObj instanceof logic.createJS.Text){setText(displayObj,rec);try{var textBounds=displayObj.getBounds();if(textBounds!=null){if(textBounds.width>textWidth)textWidth=textBounds.width;if(textBounds.height>textHeight)textHeight=textBounds.height}}catch(e){logic.utils.log("ERROR: Can't test textfields bounds due to: "+e.message)}}displayObj.set({rec:rec});if(checkVisibility)displayObj.visible=resolveVisibility(displayObj,aindex)}if(assetMap["text"+aindex]!==undefined){var textContainer=assetMap["text"+aindex];var hotspot=new logic.createJS.Shape;hotspot.graphics.beginFill("#000").drawRect(0,0,textWidth,textHeight);textContainer.hitArea=hotspot}},setImage:function(img,stub){var bitmap,ctrW,ctrH;var scale=stub.nominalBounds?Math.min(stub.nominalBounds.width/img.width,stub.nominalBounds.height/img.height):1;var imgWidth=img.width*scale;var imgHeight=img.height*scale;if(initvars[C.SMOOTHING]!==undefined){var smoothing=initvars[C.SMOOTHING].toLowerCase();smoothing=["high","medium","low"].indexOf(smoothing)!=-1?smoothing:"high";var canvas=document.createElement("canvas");canvas.width=imgWidth;canvas.height=imgHeight;var context=canvas.getContext("2d");context.mozImageSmoothingEnabled=true;context.webkitImageSmoothingEnabled=true;context.msImageSmoothingEnabled=true;context.imageSmoothingEnabled=true;context.imageSmoothingQuality=smoothing;context.drawImage(img,0,0,imgWidth,imgHeight);bitmap=new logic.createJS.Bitmap(canvas);ctrW=imgWidth;ctrH=imgHeight}else if(logic.utils.getUserAgent()!="ie"){try{img=logic.processing.resize_image(img,scale)}catch(err){logic.tracking.sentryException(err,{tags:{action:"resize_image"}})}var sharpness=.1;if(initvars[C.SHARPENING]!==undefined){sharpness=parseFloat(initvars[C.SHARPENING])}try{logic.processing.sharpen_image(img,sharpness)}catch(err){logic.tracking.sentryException(err,{tags:{action:"sharpen_image"}})}bitmap=new logic.createJS.Bitmap(img);ctrW=img.width;ctrH=img.height}else{bitmap=new logic.createJS.Bitmap(img);bitmap.scaleX=bitmap.scaleY=scale;ctrW=imgWidth;ctrH=imgHeight}bitmap.x=Math.round((stub.nominalBounds.width-ctrW)/2);bitmap.y=Math.round((stub.nominalBounds.height-ctrH)/2);return bitmap},placeImage:placeImage,setStaticText:function(){for(var prop in assetMap){if(assetMap.hasOwnProperty(prop)){if(initvars[C.TEXT_OVERRIDE+prop]!==undefined){for(var i=0;i<assetMap[prop].length;i++){var obj=assetMap[prop][i];if(obj instanceof logic.createJS.Text){var text_override=initvars[C.TEXT_OVERRIDE+prop];text_override=text_override.replace("\\n","\n");placeText(obj,unescape(text_override))}}}}}},setNestedText:function(name){if(!initvars[C.TEXT_OVERRIDE+name])return;for(var i=1;i<=logic.tree.getNumImages();i++){var asset=assetMap[name+i];if(!asset)continue;asset.forEach(function(obj){if(obj instanceof logic.createJS.Text)placeText(obj,initvars[C.TEXT_OVERRIDE+name])})}},setSalePriceOption:function(){var render=function(assetList){for(var a=0;a<assetList.length;a++){if(assetList[a]instanceof logic.createJS.Text){setText(assetList[a],assetList[a].rec)}}};for(var i=1;i<=logic.tree.getNumImages();i++){var assetList=assetMap[C.PRICE+i];if(assetList)render(assetList);assetList=assetMap[C.SALE_PRICE+i];if(assetList)render(assetList);assetList=assetMap[C.PERCENT_OFF+i];if(assetList)render(assetList)}},setThemeColor:function(hex,name){for(var x=0;x<customizable.length;x++){var obj=customizable[x];if(name&&obj.name!=name)continue;if(obj&&obj.shape){obj.shape.graphics.clear();obj.shape.graphics.f(hex).s().p(obj.shape["drawPath"])}}},loadBusinessBadge:function(){try{var stub=assetMap["badge"][0];logic.touch.nav(stub);var hotspot=new logic.createJS.Shape;hotspot.graphics.beginFill("#000").drawRect(0,0,stub.nominalBounds.width,stub.nominalBounds.height);stub.hitArea=hotspot}catch(err){logic.utils.log(">> Error: Business badge stub missing!");return}if(!badgeMap){logic.utils.loadJSON(C.BADGE_ART_PATH+"badges.json",function(data){logic.utils.log(">> BADGES | Map successfully loaded.",data);badgeMap=data;return logic.tree.loadBusinessBadge()},function(xhr){logic.utils.log(">> BADGES | Error loading map!",xhr);return},false)}var aspect=logic.app.getRoot()["badgeLayout"];var badgeId=aspect?initvars[C.BADGE_ID]+"_"+aspect:initvars[C.BADGE_ID];var imgPath=badgeMap[badgeId];if(!imgPath){logic.utils.log(">> Error: Can't find business badge url for id: "+badgeId);return}var imgUrl=C.BADGE_ART_PATH+imgPath;logic.utils.loadImage(imgUrl,function(img){var bitmap=logic.tree.setImage(img,stub);stub.removeAllChildren();stub.addChild(bitmap)},function(xhr){logic.utils.log(">> Error: Business badge image failed to load: "+xhr.statusText)})},getAssetByName:function(name){return assetMap[name]},getNumImages:function(){return numImages},getImageSize:function(i){return imageSizeMap[i]},_test_:{setText:setText,customizable:customizable,setNumImages:function(n){numImages=n}}}})();AdRollLiquidAds.utils={isMobile:function(){return(navigator.userAgent.match(/Android/i)||navigator.userAgent.match(/BlackBerry/i)||navigator.userAgent.match(/iPhone|iPad|iPod/i)||navigator.userAgent.match(/Opera Mini/i)||navigator.userAgent.match(/Silk/i)||navigator.userAgent.match(/Mobile Safari/i)||navigator.userAgent.match(/IEMobile/i))!=null},getUserAgent:function(){var a=navigator.userAgent.toLowerCase();if(a.indexOf("safari")!==-1&&a.indexOf("chrome")===-1){if(a.indexOf("version/5.")!==-1){return"safari5"}return"safari"}if(a.indexOf("msie")!==-1||navigator.appVersion.indexOf("trident/")>0){return"ie"}if(a.indexOf("edg/")!==-1){return"edge"}if(a.indexOf("firefox")!==-1){return"firefox"}if(a.indexOf("chrome/")!==-1){return"chrome"}if(a.indexOf("brave")!==-1){return"brave"}},getLocProtocol:function(){return"https:"==document.location.protocol?"https":"http"},isDemo:function(){if(initvars.demo===undefined)return false;return AdRollLiquidAds.utils.getBool(initvars.demo)},isDebug:function(){var url=AdRollLiquidAds.utils.getQueryVariable("armature_url");if(!url){return false}return url.indexOf("debug.liquidads.min.js")!=-1},isTest:function(){return initvars.type==AdRollLiquidAds.CONSTANTS.TYPE_DYNAMIC_TESTS},supportedVideoFormat:function(video){if(!video.hasOwnProperty("canPlayType"))return"mp4";var extension="";if(video.canPlayType("video/webm")=="probably"||video.canPlayType("video/webm")=="maybe"){extension="webm"}else if(video.canPlayType("video/mp4")=="probably"||video.canPlayType("video/mp4")=="maybe"){extension="mp4"}return extension},isRetina:function(){if(window.matchMedia){var mq=window.matchMedia("only screen and (min--moz-device-pixel-ratio: 1.3), only screen and (-o-min-device-pixel-ratio: 2.6/2), only screen and (-webkit-min-device-pixel-ratio: 1.3), only screen  and (min-device-pixel-ratio: 1.3), only screen and (min-resolution: 1.3dppx)");return mq&&mq.matches||window.devicePixelRatio>1}},loadJSON:function(path,success,error,withCredentials){var xhr=new XMLHttpRequest;xhr.open("GET",path,true);xhr.onreadystatechange=function(){if(xhr.readyState===4){if(xhr.status===200){if(success){try{success(JSON.parse(xhr.responseText))}catch(e){error(xhr)}}}else{if(error)error(xhr)}}};if(withCredentials){xhr.withCredentials=true}xhr.send()},loadImageWithXHR:function(path,success,error){var xhr=new XMLHttpRequest;var rnd=Math.random();var urlObj=window.URL?window.URL:window.webkitURL;xhr.open("GET",path,true);xhr.responseType="blob";xhr.onreadystatechange=function(){if(xhr.readyState===4){if(xhr.status===200){var img=new Image;img.onload=function(){urlObj.revokeObjectURL(img.src);success(img,rnd)};img.src=urlObj.createObjectURL(xhr.response)}else{error(xhr)}}else if(xhr.readyState===2&&xhr.status!==200){xhr.responseType="json"}};xhr.send();return rnd},loadImageWithDOM:function(path,success,error,noCORS){var rnd=Math.random();var img=new Image;img.onload=function(){success(img,rnd)};img.onerror=error;if(!noCORS){img.crossOrigin="anonymous"}img.src=path;if(img.complete||img.complete===undefined){var crossOriginValue=img.crossOrigin;img.crossOrigin=null;img.src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==";img.crossOrigin=crossOriginValue;img.src=path}return rnd},loadImage:function(path,success,error,noCORS){if(window.URL||window.webkitURL){return AdRollLiquidAds.utils.loadImageWithXHR(path,success,error)}else{return AdRollLiquidAds.utils.loadImageWithDOM(path,success,error,noCORS)}},loadFonts:function(root,stats){if(root.customFont.constructor!==Array)root.customFont=[root.customFont];for(var index=0;index<root.customFont.length;index++){var fontObj=root.customFont[index];var source=fontObj.source=="adroll"?"custom":fontObj.source;if(WebFontConfig[source]===undefined)WebFontConfig[source]={families:[]};if(fontObj.name.charAt(fontObj.name.length-1)==":")fontObj.name=fontObj.name.slice(0,-1);var split=fontObj.name.split(":");var fontname=split[0].replace(/ /g,"+");if(split[1])fontname+=":"+split[1].replace(/ /g,"");WebFontConfig[source].families.push(fontname);if(fontObj.source=="adroll"){if(WebFontConfig["custom"].urls===undefined)WebFontConfig["custom"].urls=[];fontname=split[0].replace(/ /g,"-").toLowerCase();WebFontConfig["custom"].urls.push(AdRollLiquidAds.CONSTANTS.ADROLL_FONT_CSS+fontname+"/font.css");WebFontConfig.adroll=true}if(fontObj.name.indexOf(":")!=-1){stats.target+=split[1].split(",").length}else{stats.target++}}var fontScript=document.createElement("script");fontScript.src=AdRollLiquidAds.utils.getLocProtocol()+AdRollLiquidAds.CONSTANTS.FONT_LOADER_URL;fontScript.type="text/javascript";fontScript.async="true";var scriptTag=document.getElementsByTagName("script")[0];scriptTag.parentNode.insertBefore(fontScript,scriptTag)},getWebFontFamilies:function(){if(WebFontConfig["google"]!=undefined||WebFontConfig["custom"]!=undefined){var families=[];if(WebFontConfig["google"]!=undefined)families=families.concat(WebFontConfig["google"].families);if(WebFontConfig["custom"]!=undefined)families=families.concat(WebFontConfig["custom"].families);return families}return null},nameChildren:function(node){for(var prop in node){if(node[prop]instanceof AdRollLiquidAds.createJS.DisplayObject){var displayObj=node[prop];if(displayObj.name===null){displayObj.name=prop;if(displayObj instanceof AdRollLiquidAds.createJS.Container&&displayObj.name!="parent"&&displayObj.numChildren>0){AdRollLiquidAds.utils.nameChildren(displayObj)}}}}},getTimer:function(callback,delay){function Timer(cb,d){var timerId,start,dur=d,remaining=d,resets=0,running=true;this.pause=function(){window.clearTimeout(timerId);remaining-=new Date-start;running=false};this.resume=function(){start=new Date;window.clearTimeout(timerId);timerId=window.setTimeout(cb,dur);running=true};this.stop=function(){window.clearTimeout(timerId);running=false};this.reset=function(){resets++;this.stop();this.resume()};this.setDelay=function(d){dur=d};this.getStartTime=function(){return start.getTime()};this.isRunning=function(){return running};this.numResets=function(){return resets};this.resume()}return new Timer(callback,delay)},createVideoPlacement:function(source,width,height,loop){function VideoPlacement(s,w,h,l){var source=s||null,width=w||AdRollLiquidAds.app.getStageDimensions().width,height=h||AdRollLiquidAds.app.getStageDimensions().height,loop=l||false,adDiv=document.getElementById("liquidAdCanvas").parentElement,video;this.onError=null;this.onLoaded=null;this.onComplete=null;this.id=null;this.data=null;this.init=function(){if(initvars[AdRollLiquidAds.CONSTANTS.ALLOW_VIDEO]&&AdRollLiquidAds.utils.getBool(initvars[AdRollLiquidAds.CONSTANTS.ALLOW_VIDEO])==false){this.onError();return}video={div:document.createElement("div"),element:document.createElement("video")};if(document.getElementById(this.id))adDiv.removeChild(document.getElementById(this.id));adDiv.appendChild(video.div).appendChild(video.element);video.div.setAttribute("id",this.id);video.div.setAttribute("style","display:none;");var videoType=AdRollLiquidAds.utils.supportedVideoFormat(video.element);if(videoType==""){AdRollLiquidAds.utils.log("ERROR: No video support in this browser!");this.onError();return}video.src=document.createElement("source");source=source.indexOf(".webm")==-1&&source.indexOf(".mp4")==-1?source+"."+videoType:source;video.src.setAttribute("src",source);video.src.addEventListener("error",this.onError);video.element.appendChild(video.src);video.element.addEventListener("canplaythrough",this.onLoaded,false);video.element.addEventListener("ended",this.onComplete,false);video.element.setAttribute("width",width);video.element.setAttribute("height",height);video.element.setAttribute("muted","true");video.element.setAttribute("controls","false");video.element.muted=true;if(loop)video.element.setAttribute("loop","true")};this.getHtml=function(){return video};this.play=function(){video.element.play()};this.pause=function(){video.element.pause()};this.shutdown=function(){if(video){video.element.removeEventListener("canplaythrough",this.onLoaded,false);video.element.removeEventListener("ended",this.onComplete,false);if(document.getElementById(this.id))adDiv.removeChild(document.getElementById(this.id))}this.onError=null;this.onLoaded=null;this.onComplete=null;video=null}}return new VideoPlacement(source,width,height,loop)},replaceWildcards:function(subject,wildcard,replacement){var out=subject;var matches=subject.match(/\[\w+\]/g);for(var i=0;i<matches.length;i++){if(matches[i]===wildcard){out=out.replace(matches[i],replacement)}}return out},getBool:function(value){if(!value)return false;if(typeof value=="string"){var string=value.toLowerCase();if(string=="true"){return true}else if(string=="false"){return false}}return Boolean(value)},getMedian:function(array){array.sort(function(a,b){return a-b});var half=Math.floor(array.length/2);if(array.length%2){return array[half]}else{return(array[half-1]+array[half])/2}},array_contains:function(arr,obj){var len=arr.length;for(var i=0;i<len;i++){if(arr[i]===obj)return true}return false},parse_money:function(str){if(typeof str!=="string")return str;return parseFloat(str.replace(/[^0-9\.]/g,""))},decimal_places:function(num){var match=(""+num).match(/(?:\.(\d+))?(?:[eE]([+-]?\d+))?$/);if(!match){return 0}return Math.max(0,(match[1]?match[1].length:0)-(match[2]?+match[2]:0))},decode_html:function(str){var txt=document.createElement("textarea");txt.innerHTML=str;return txt.value},parse_px:function(str){return str.match(/[0-9]+(?=px)/)[0]},is_num_in_range:function(num,target,range){if(num>target)return num<=target+range;if(num<target)return num>=target-range;return true},remove_enclosure:function(str,enc){if(str.charAt(0)==enc&&str.charAt(str.length-1)==enc){str=str.substring(1,str.length-1)}return str},queryAppend:function(url,param){if(!param||typeof param!=="string"){return url}var joiner="?";if(url.indexOf("?")!==-1)joiner="&";if(this.startsWith(param,"?")||this.startsWith(param,"&"))param=param.substr(1);return url+joiner+param},getQueryVariable:function(variable){var query=window.location.search.substring(1);var vars=query.split("&");for(var i=0;i<vars.length;i++){var pair=vars[i].split("=");if(pair[0]==variable){return pair[1]}}return null},getDestinationUrl:function(url,pid){var logic=AdRollLiquidAds;var defaultUrl=initvars[logic.CONSTANTS.DEFAULT_CLICK];var result=url;if(initvars[logic.CONSTANTS.CLICK_OVERRIDE]!==undefined){result=initvars[logic.CONSTANTS.CLICK_OVERRIDE]}if(result||defaultUrl&&defaultUrl!=""){result=result||defaultUrl;if(initvars[logic.CONSTANTS.TRACKING]!==undefined){var tracking=initvars[logic.CONSTANTS.TRACKING];if(tracking.indexOf("[product_id]")!==-1){if(pid===undefined)pid="0";tracking=logic.utils.replaceWildcards(tracking,"[product_id]",encodeURIComponent(pid))}var replaceAmp=function(i){return tracking.substr(0,i)+"%26"+tracking.substr(i+1)};var lastAmp=-1;for(var x=0;x<tracking.length;x++){var c=tracking.charAt(x);if(c=="&"){if(lastAmp!=-1){tracking=replaceAmp(lastAmp);lastAmp=-1}else{lastAmp=x}}else if(c=="="){lastAmp=-1}}if(lastAmp!=-1)tracking=replaceAmp(lastAmp);result=logic.utils.queryAppend(result,tracking)}if(initvars[logic.CONSTANTS.PREFIX]!==undefined){var prefix=initvars[logic.CONSTANTS.PREFIX];if(prefix.indexOf("?")==-1)prefix=prefix+"?";result=prefix.search(/(doubleclick)/i)!=-1?prefix+result:prefix+encodeURIComponent(result)}result=logic.utils.isDemo()?result:logic.utils.queryAppend(initvars[logic.CONSTANTS.CLICK_TAG],"desturl="+encodeURIComponent(result))}else{result=initvars[logic.CONSTANTS.CLICK_TAG]}return result},parseValueStringList:function(valueArray){var valueMap={};for(var i=0;i<valueArray.length;i++){if(valueArray[i].indexOf(":")!=-1){valueMap[valueArray[i].substring(0,valueArray[i].indexOf(":")).trim()]=parseInt(valueArray[i].substring(valueArray[i].indexOf(":")+1))}}return valueMap},getEID:function(){var tag=initvars[AdRollLiquidAds.CONSTANTS.FAIL_TAG];return tag.substring(tag.lastIndexOf("/")+1,tag.lastIndexOf("."))},getAssetIndex:function(name){var test=name.indexOf("image")!=-1&&name.indexOf("_")!=-1?name.substr(0,name.indexOf("_")):name;var pattern=/\d+$/;var result=pattern.exec(test);return result?parseInt(result[0]):-1},stripAssetIndex:function(name){var test=name.indexOf("image")!=-1&&name.indexOf("_")!=-1?name.substr(0,name.indexOf("_")):name;var pattern=/\d+$/;var index=test.search(pattern);if(index==-1)return test;return test.slice(0,index)},getParentIndex:function(obj){var assetIndex=AdRollLiquidAds.utils.getAssetIndex(obj.name);if(assetIndex!=-1)return assetIndex;if(obj&&obj.parent&&obj.parent.name){var parent=obj.parent;assetIndex=AdRollLiquidAds.utils.getAssetIndex(parent.name);if(assetIndex==-1){return AdRollLiquidAds.utils.getParentIndex(parent)}}return assetIndex},parseTimestamp:function(time){var split=time.split(" ");var splitDate=split[0].split("-");var splitTime=split[1].split(":");if(splitDate[0].length!=4||splitTime[0].length!=2){return null}return new Date(splitDate[0],splitDate[1]-1,splitDate[2],splitTime[0],splitTime[1],splitTime[2])},getUTCDate:function(date){var nd=new Date;var offset=date.getTimezoneOffset()*60*1e3;nd.setTime(date.getTime()+offset);return nd},log:function(message,obj){if(AdRollLiquidAds.utils.isDemo()==true&&initvars.type!=AdRollLiquidAds.CONSTANTS.TYPE_DYNAMIC_TWA||AdRollLiquidAds.utils.getBool(initvars[AdRollLiquidAds.CONSTANTS.ALLOW_LOG])){if(obj){console.log(message,obj)}else{console.log(message)}}},logError:function(message,obj){if(!initvars["errors"])initvars["errors"]=[];if(initvars["errors"].indexOf(message)==-1){var dms=AdRollLiquidAds.app.getStageDimensions();console.error("AdRoll ["+dms.width+"x"+dms.height+"] "+message,obj);initvars["errors"].push(message)}},startsWith:function(str1,str2){return!str1.indexOf(str2)},REGEX_TITLECASE_SPLIT:new RegExp('[\\"\\s\\!\\&\\/\\.\\,\\-\\_\\\\]'),REGEX_TITLECASE_SPLIT_SINGLE_QUOTE:new RegExp("[\\']"),REGEX_ITERATE_STR:new RegExp(".","g"),toTitleCase:function(str){var previousChar="",previousPreviousChar="";var convertedChar="";var alreadyConvertedChars=[];var regexResult;while((regexResult=AdRollLiquidAds.utils.REGEX_ITERATE_STR.exec(str))!==null){var currentChar=regexResult[0];if(alreadyConvertedChars.length==0||previousChar.match(AdRollLiquidAds.utils.REGEX_TITLECASE_SPLIT)){convertedChar=currentChar.toUpperCase()}else if(previousChar.match(AdRollLiquidAds.utils.REGEX_TITLECASE_SPLIT_SINGLE_QUOTE)){if(previousPreviousChar==""||previousPreviousChar.match(AdRollLiquidAds.utils.REGEX_TITLECASE_SPLIT)){convertedChar=currentChar.toUpperCase()}else{convertedChar=currentChar.toLowerCase()}}else{convertedChar=currentChar.toLowerCase()}previousPreviousChar=previousChar;previousChar=currentChar;alreadyConvertedChars.push(convertedChar)}return alreadyConvertedChars.join("")},hasJapaneseCharacters:function(str){var regex=/[\u3000-\u303F]|[\u3040-\u309F]|[\u30A0-\u30FF]|[\uFF00-\uFFEF]|[\u4E00-\u9FAF]|[\u2605-\u2606]|[\u2190-\u2195]|\u203B/g;if(regex.test(str)){return true}return false}};(function(){var logic=AdRollLiquidAds;var PARAMETERS=logic.CONSTANTS;var productMap=[];var clickCount=0;var sentryErrors=[];var ok=false;return AdRollLiquidAds.tracking={logEvent:function(event,params){var data="version="+PARAMETERS.getVersion();if(logic.datamodel){var latency=(new Date).getTime()-logic.datamodel.getInitLoadStats().start_time.getTime();var recLoadTime=logic.datamodel.getInitLoadStats().rec_load_time;var experiment=logic.datamodel.getExperiment();if(experiment!==undefined){var algoData="";for(var key in params.algo_data){if(params.algo_data.hasOwnProperty(key)){algoData+="&"+key+"="+encodeURIComponent(params.algo_data[key])}}data+="&experiment_bucket="+logic.datamodel.getExperimentBucket();data+="&experiment_eid="+experiment["experiment_eid"]}if(logic.app.isYelpAd())data+="&yelp=true"}else if(initvars.type==logic.CONSTANTS.TYPE_PERSONALIZED){data+="&adv_eid="+initvars[logic.CONSTANTS.B2B_AD_EID];data+="&keys_eid="+initvars[logic.CONSTANTS.B2B_KEYS_EID]}var appendFieldData=function(data){var output="";for(var field in data){output+="&"+field+"="+encodeURIComponent(data[field])}return output};var fetchIds=function(recList){if(!recList){return""}var ids=[];for(var i in recList){if(recList[i]){ids.push(recList[i].id)}}return ids.join(",")};switch(event){case PARAMETERS.EVENT_INIT:data+="&mobile="+logic.app.isMobile();data+="&retina="+logic.utils.isRetina();break;case PARAMETERS.EVENT_OK:if(ok){logic.tracking.sentryMessage("NOTICE: Attempting to send liquid_ok more than once!",{tags:logic.datamodel.getInitLoadStats()});return}if(latency)data+="&latency="+latency;if(recLoadTime)data+="&rec_load_time="+recLoadTime;data+="&mobile="+logic.app.isMobile();ok=true;break;case PARAMETERS.EVENT_IMG:data+="&num_images="+params.num;data+="&median_time="+params.median;data+="&max_time="+params.max;data+="&total_time="+params.total;data+="&mobile="+logic.app.isMobile();if(logic.app.isYelpAd()||logic.app.isFeatureEnabled("cachet-test"))data+="&cachet=true";break;case PARAMETERS.EVENT_CLICK:if(params.coords)data+="&coords="+params.coords;if(params.pid)data+="&pid="+params.pid;if(params.src)data+="&source="+params.src;if(params.pos)data+="&position="+params.pos;if(initvars.type==logic.CONSTANTS.TYPE_DYNAMIC){clickCount++;data+="&count="+clickCount;data+="&stopped="+logic.app.isStopped()}if(latency)data+="&time="+latency;if(params.click_origin)data+="&click_origin="+params.click_origin;if(params.action)data+="&action="+params.action;if(algoData!=="")data+=algoData;if(params.field_data)data+=appendFieldData(params.field_data);if(params.price_normalized)data+="&price_normalized="+encodeURIComponent(params.price_normalized);if(params.locale)data+="&locale="+encodeURIComponent(params.locale);if(params.product_date)data+="&product_date="+encodeURIComponent(params.product_date);if(params.pghash)data+="&pghash="+encodeURIComponent(params.pghash);break;case PARAMETERS.EVENT_HOVER:var stageSize=logic.app.getStageDimensions();data+="&size="+stageSize.width+":"+stageSize.height;var coordString="";for(var idx=0;idx<params.list.length;idx++){var loc=params.list[idx];coordString+=loc.x+":"+loc.y;if(idx<params.list.length-1)coordString+="|"}data+="&coords="+coordString;break;case PARAMETERS.EVENT_FAILURE:case PARAMETERS.EVENT_PERS_FAILURE:data+="&code="+params.code;if(latency)data+="&latency="+latency;data+="&mobile="+logic.app.isMobile();data+="&init="+params.init;data+="&imgs="+params.imgs;data+="&recs="+params.recs;data+="&msg="+params.msg;if(logic.app.isYelpAd()||logic.app.isFeatureEnabled("cachet-test"))data+="&cachet=true";if(logic.datamodel){data+="&recList="+encodeURIComponent(fetchIds(logic.datamodel.getRecList()))}break;case PARAMETERS.EVENT_TRECS_OK:if(params.service)data+="&service="+params.service;if(params.optimization)data+="&optimization_target="+params.optimization;break;case PARAMETERS.EVENT_TRECS_FALLBACK:if(params.error_code)data+="&trecs_error_code="+params.error_code;if(params.error_message)data+="&trecs_error_message="+encodeURIComponent(params.error_message);break;case PARAMETERS.EVENT_ENGAGEMENT:data+="&action="+params.action;break;case PARAMETERS.EVENT_IMPRESSION:if(productMap.indexOf(params.pid)===-1){productMap.push(params.pid);data+="&pid="+params.pid;data+="&source="+params.src;data+="&position="+params.pos;if(params.action)data+="&action="+params.action;if(algoData!=="")data+=algoData;if(params.field_data)data+=appendFieldData(params.field_data);if(params.price_normalized)data+="&price_normalized="+encodeURIComponent(params.price_normalized);if(params.locale)data+="&locale="+encodeURIComponent(params.locale);if(params.product_date)data+="&product_date="+encodeURIComponent(params.product_date);if(params.pghash)data+="&pghash="+encodeURIComponent(params.pghash)}else{return}break;case PARAMETERS.EVENT_PERS_IMPRESSION:if(params.hasOwnProperty("text1_failsafe")&&params.hasOwnProperty("full_data")){data+="&full_data="+params["full_data"];break}for(var p in params){data+="&"+p+"="+params[p]}break;case PARAMETERS.EVENT_PERS_CLICK:data+="&url="+params.url;break}if(initvars.engageTAG===undefined){return}var url=initvars.engageTAG;url=logic.utils.queryAppend(url,"adroll_stat_name="+event);if(data!="")url=logic.utils.queryAppend(url,"adroll_stat_data="+encodeURIComponent(data));logic.utils.log(">> TRACK: "+url);if(logic.utils.isDemo()==false){var xhr=new XMLHttpRequest;xhr.open("GET",url,true);xhr.withCredentials=true;xhr.send()}},sentryMessage:function(msg,tags){if(logic.utils.isDemo()==true||logic.utils.isTest()==true||sentryErrors.indexOf(msg)!=-1){return}sentryErrors.push(msg);if(!window.Raven){console.log("Raven unavailable! Unable to send message: "+msg);return}try{Raven.captureMessage(msg,tags)}catch(err){console.log("ERROR: Could not send message to Sentry ("+msg+") due to "+err.message)}},sentryException:function(err,tags){if(logic.utils.isDemo()==true||logic.utils.isTest()==true||sentryErrors.indexOf(tags.tags.action)!=-1){return}sentryErrors.push(tags.tags.action);if(!window.Raven){console.log("Raven unavailable! Unable to send exception: "+err.message);return}try{Raven.captureException(err,tags)}catch(e){console.log("ERROR: Could not send exception to Sentry ("+err.message+") due to "+e.message)}}}})();(function(){var logic=AdRollLiquidAds;var clickCoords="";var lastClickTime;function handleClick(evt){evt.stopPropagation?evt.stopPropagation():evt.cancelBubble=true;switch(evt.currentTarget.clicktype){case"product":onProductClick(evt);break;case"nav":onNavClick(evt);break;default:onStageClick(evt)}return false}function onProductClick(evt){if(checkClickBufferOk()==false)return;setClickHeatMapCoords(evt.stageX,evt.stageY);var name=logic.utils.getAssetIndex(evt.currentTarget.name)==-1?evt.currentTarget.name+logic.utils.getParentIndex(evt.currentTarget):evt.currentTarget.name;logic.app.onProductSelect(name);lastClickTime=(new Date).getTime()}function onNavClick(evt){logic.app.onNavClick(evt.currentTarget.name)}function onStageClick(evt){if(checkClickBufferOk()==false)return;var x=evt.stageX;var y=evt.stageY;if(x==undefined||y==undefined){var mousePos=getMousePos(evt);x=mousePos.x;y=mousePos.y}setClickHeatMapCoords(x,y);logic.app.onStageSelect(null,evt.currentTarget.name);lastClickTime=(new Date).getTime()}function checkClickBufferOk(){if(!lastClickTime)return true;var now=(new Date).getTime();return now-lastClickTime>1e3}function getMousePos(evt){var canvas=logic.app.getStage().canvas;var offsetX=0,offsetY=0,mx,my;if(canvas.offsetParent!==undefined){do{offsetX+=canvas.offsetLeft;offsetY+=canvas.offsetTop}while(canvas=canvas.offsetParent)}mx=evt.pageX-offsetX;my=evt.pageY-offsetY;return{x:mx,y:my}}function setClickHeatMapCoords(xPos,yPos){var dimensions=logic.app.getStageDimensions();clickCoords=xPos+":"+dimensions.width+"|"+yPos+":"+dimensions.height}function trackHovers(stage){var hoverTrail,timeout,lastPointTime,hoverInterval;var reset=function(){lastPointTime=0,hoverInterval=20;hoverTrail=[]};reset();var capture=function(){logic.tracking.logEvent(logic.CONSTANTS.EVENT_HOVER,{list:hoverTrail});reset()};var onMouseMove=function(evt){window.clearTimeout(timeout);timeout=setTimeout(onTimeout,200);if(Date.now()-lastPointTime<hoverInterval)return;lastPointTime=Date.now();hoverTrail.push(getMousePos(evt));if(hoverTrail.length>=150){capture()}};var onTimeout=function(){if(hoverTrail.length>=10)capture()};stage.addEventListener("mouseenter",function(e){reset();stage.canvas.addEventListener("mousemove",onMouseMove)});stage.addEventListener("mouseleave",function(e){stage.canvas.removeEventListener("mousemove",onMouseMove);window.clearTimeout(timeout);onTimeout()})}return AdRollLiquidAds.touch={init:function(root){var dimensions=logic.app.getStageDimensions();var stage=logic.app.getStage();var bg=new createjs.Shape;bg.name="stageHitArea";bg.graphics.f("rgba(255,255,255,0.01)").dr(0,0,dimensions.width,dimensions.height);stage.name="stage";stage.addChildAt(bg,0);stage.update();logic.touch.stage(stage);if(logic.app.isMobile()==false){stage.cursor="pointer";stage.enableMouseOver(10)}},product:function(cont){cont.addEventListener("click",handleClick);cont.set({clicktype:"product"})},nav:function(btn){btn.addEventListener("click",handleClick);btn.set({clicktype:"nav"})},stage:function(obj){obj.addEventListener("click",handleClick);obj.set({clicktype:"stage"})},getClickPos:function(){return clickCoords}}})();(function(){var logic=AdRollLiquidAds;var C=logic.CONSTANTS;var autoBlink,dscMenu,pageMenu,videoLoop,imageZoomList,flyoverImg,countdownTimer,slideshow;function InteractiveMenu(root){var params=root["dscMenu"];if(params["numObjects"]!==undefined){var dscList=[];for(var i=1;i<=params["numObjects"];i++){var dsc=logic.tree.getAssetByName("dsc"+i)[0];dsc.tickEnabled=true;dsc.addEventListener("mouseover",root["dscOver"]);dsc.addEventListener("mouseout",root["dscOut"]);dscList.push(dsc)}return}var buttonList=[];var button,index;if(params["objects"]!==undefined){for(index=0;index<params["objects"].length;index++){button=eval("root."+params["objects"][index]);if(button)buttonList.push(button)}}else{for(index=1;index<10;index++){var btns=logic.tree.getAssetByName("button"+index);if(btns)buttonList.push(btns[0])}}var onLeave=function(e){logic.utils.log(">> Mouse left the canvas bounds.");var resetDsc=function(b){b.dispatchEvent(new logic.createJS.Event("mouseout"))};buttonList.forEach(resetDsc);logic.app.getStage().canvas.removeEventListener("mouseout",onLeave)};var onOver=function(e){logic.app.getStage().canvas.addEventListener("mouseout",onLeave);try{root["dscOver"](e)}catch(err){logic.utils.log(">> ERROR: Exception thrown from dscOver() handler: "+err.message)}};var onOut=function(e){try{root["dscOut"](e)}catch(err){logic.utils.log(">> ERROR: Exception thrown from dscOut() handler: "+err.message)}};var initButtons=function(btn){btn.addEventListener("mouseover",onOver);btn.addEventListener("mouseout",onOut);if(params.click==true)btn.addEventListener("click",root["dscPress"])};buttonList.forEach(initButtons)}function AutoBlinkComponent(root){var params=root["autoBlink"];var numObjects=params["numObjects"];var pauseTime=logic.app.getPauseTime()*1e3/(numObjects+1);var order=[];if(params["order"]!==undefined){order=params["order"]}else{for(var i=1;i<=numObjects;i++)order.push(i)}var currentIndex=-1;var blinkTimer=null;var startTimer=function(){if(logic.app.isStopped())return;blinkTimer=logic.utils.getTimer(onBlinkTimer,pauseTime)};var onBlinkTimer=function(){currentIndex++;if(currentIndex==order.length){currentIndex=-1;if(!logic.utils.getBool(initvars[C.AUTO_SCROLL])){onMainTimerComplete();onMainTimerStart()}return}if(logic.tree.getAssetByName("dsc"+order[currentIndex])!==undefined){var dsc=logic.tree.getAssetByName("dsc"+order[currentIndex])[0];try{root["blink"](dsc)}catch(err){logic.utils.log(">> ERROR: Exception thrown from blink() handler: "+err.message)}}startTimer()};var onMainTimerStart=function(evt){startTimer()};var onMainTimerComplete=function(evt){root.reset();currentIndex=-1;if(blinkTimer!==null){blinkTimer.stop();blinkTimer=null}};var onMainAnimComplete=function(evt){root.removeEventListener("onDisplayStart",onMainTimerStart);root.removeEventListener("onTransitionStart",onMainTimerComplete);root.removeEventListener("onTransitionComplete",onMainTimerStart);root.removeEventListener("onAnimationComplete",onMainAnimComplete);root.reset();if(blinkTimer!==null){blinkTimer.stop();blinkTimer=null}};root.addEventListener("onDisplayStart",onMainTimerStart);root.addEventListener("onTransitionStart",onMainTimerComplete);root.addEventListener("onTransitionComplete",onMainTimerStart);root.addEventListener("onAnimationComplete",onMainAnimComplete);this.pause=function(){if(blinkTimer&&blinkTimer.isRunning())blinkTimer.pause()};this.resume=function(){if(blinkTimer&&!blinkTimer.isRunning())blinkTimer.resume()};this.stop=function(){if(blinkTimer!==null){blinkTimer.stop();blinkTimer=null}}}function PageMenuComponent(root){var params=root["pageMenu"];var menu=params["object"]?root[params.object]:root["page_menu"];if(!menu)return;var currentRecIndex=0;var catchTransEvent=false;var onMainTimerStart=function(evt){root.removeEventListener("onPauseTimerStart",onMainTimerStart);onTransComplete(null)};var onTransComplete=function(evt){if(catchTransEvent){catchTransEvent=false;return}var timeline=menu["covers"].timeline;var recIndex=logic.app.getFocusedRecIndex();var targetFrame=recIndex>currentRecIndex?timeline.position+1:timeline.position-1;if(targetFrame==timeline.duration||recIndex==0)targetFrame=1;if(targetFrame==0)targetFrame=timeline.duration-1;menu["covers"].gotoAndStop(targetFrame);currentRecIndex=recIndex};root.addEventListener("onPauseTimerStart",onMainTimerStart);root.addEventListener("onTransitionComplete",onTransComplete);var onButtonSelect=function(evt){var index=evt.currentTarget.name.slice(-1);var current=menu["covers"].timeline.position;catchTransEvent=true;logic.app.onPageMenuSelect(index-current);menu["covers"].gotoAndStop(parseInt(index));root.dispatchEvent(new logic.createJS.Event("onPageMenuSelect"))};for(var i=0;i<menu.numChildren;i++){var button=menu.getChildByName("product"+i);if(!button)continue;button.addEventListener("click",onButtonSelect)}}function ImageZoomComponent(container,params){var zoomImage,zoomImageBounds,shell;var calcXPos=function(mouseX){var xPos;if(zoomImageBounds.width<container.nominalBounds.width){xPos=container.nominalBounds.width/2-zoomImageBounds.width/2}else{xPos=(zoomImageBounds.width-container.nominalBounds.width)*(mouseX/container.nominalBounds.width);xPos=Math.min(-xPos,0)}return xPos};var calcYPos=function(mouseY){var yPos;if(zoomImageBounds.height<container.nominalBounds.height){yPos=container.nominalBounds.height/2-zoomImageBounds.height/2}else{yPos=(zoomImageBounds.height-container.nominalBounds.height)*(mouseY/container.nominalBounds.height);yPos=Math.min(-yPos,0)}return yPos};var onMouseMove=function(evt){var mouseLoc=container.globalToLocal(container.stage.mouseX,container.stage.mouseY);if(params["axis"]!="y")zoomImage.x=calcXPos(mouseLoc.x);if(params["axis"]!="x")zoomImage.y=calcYPos(mouseLoc.y);if(container.hitTest(mouseLoc.x,mouseLoc.y)==false||logic.app.getStage().mouseInBounds==false){shell.stage.removeEventListener("stagemousemove",onMouseMove);shell.removeAllChildren();container.parent.removeChild(shell);shell=null;container.visible=true;logic.app.resumeAnimation()}};var onImageLoad=function(img){shell=new createjs.Container;shell.regX=container.regX;shell.regY=container.regY;shell.x=container.x;shell.y=container.y;shell.name=logic.utils.getAssetIndex(container.name)!=-1?container.name:container.name+logic.utils.getParentIndex(container);logic.touch.product(shell);var scale=Math.min(container.nominalBounds.width/img.width,container.nominalBounds.height/img.height)*parseFloat(params["scaleFactor"]);if(logic.utils.getUserAgent()!="ie"){try{img=logic.processing.resize_image(img,scale)}catch(err){logic.tracking.sentryException(err,{tags:{action:"resize_image"}})}var sharpness=.1;if(initvars[C.SHARPENING]!==undefined)sharpness=parseFloat(initvars[C.SHARPENING]);try{logic.processing.sharpen_image(img,sharpness)}catch(err){logic.tracking.sentryException(err,{tags:{action:"sharpen_image"}})}zoomImage=new logic.createJS.Bitmap(img)}else{zoomImage=new logic.createJS.Bitmap(img);zoomImage.scaleX=zoomImage.scaleY=scale}zoomImageBounds=zoomImage.getBounds();var mouseLoc=container.globalToLocal(container.stage.mouseX,container.stage.mouseY);if(params["axis"]!="y")zoomImage.x=calcXPos(mouseLoc.x);if(params["axis"]!="x")zoomImage.y=calcYPos(mouseLoc.y);shell.addChild(zoomImage);if(params["drawBorder"]!=false){var border=new logic.createJS.Shape;var color=params["borderColor"]?params["borderColor"]:"#000000";border.graphics.beginStroke(color);var weight=params["borderThickness"]?params["borderThickness"]:1;border.graphics.setStrokeStyle(weight);border.snapToPixel=true;border.graphics.drawRect(0,0,container.nominalBounds.width,container.nominalBounds.height);shell.addChild(border)}var mask=new logic.createJS.Shape;mask.graphics.beginFill("#FF0000").drawRect(container.x-container.regX,container.y-container.regY,container.nominalBounds.width,container.nominalBounds.height);shell.mask=mask;container.parent.addChild(shell);container.visible=false;shell.mouseMoveOutside=true;shell.stage.addEventListener("stagemousemove",onMouseMove)};var onOver=function(){var rec=logic.app.getRecByContainer(container);logic.utils.loadImage(rec.getImageUrl(0),onImageLoad,logic.app.resumeAnimation);logic.app.pauseAnimation()};container.addEventListener("mouseover",onOver)}function VideoLoopComponent(root){var params=root["videoLoop"];var player=eval(params["object"]);if(!player)return;var video,bitmap;var onVideoError=function(evt){if(video){video.shutdown();video=null}var url=initvars[C.VIDEO_LOOP_IMG]?initvars[C.VIDEO_LOOP_IMG]:params["img_url"];logic.utils.loadImage(url,function(img){var scale=Math.min(player.nominalBounds.width/img.width,player.nominalBounds.height/img.height);bitmap=new logic.createJS.Bitmap(img);bitmap.scaleX=bitmap.scaleY=scale;player.addChild(bitmap)},function(xhr){logic.utils.log("Error: Could not load video loop or backup image!")})};var onVideoLoaded=function(evt){var source=video.getHtml();var bitmap=new logic.createJS.Bitmap(source.element);var scale=Math.min(player.nominalBounds.width/source.element.videoWidth,player.nominalBounds.height/source.element.videoHeight);bitmap.scaleX=bitmap.scaleY=scale;player.mouseEnabled=player.mouseChildren=false;player.removeAllChildren();player.addChildAt(bitmap,0);var timer;var checkForStart=function(){if(logic.app.isRunning()){video.play();clearInterval(timer);return true}return false};if(checkForStart()==false){timer=setInterval(checkForStart,100)}};if(logic.app.isMobile()||initvars[C.VIDEO_LOOP]==="off"){onVideoError();return}var loop=params["loop"]!==undefined&&logic.utils.getBool(params["loop"])===false?false:true;var url=initvars[C.VIDEO_LOOP]?initvars[C.VIDEO_LOOP]:params["vid_url"];video=logic.utils.createVideoPlacement(url,player.nominalBounds.width,player.nominalBounds.height,loop);video.id="liquidAdVideoLoop";video.onError=onVideoError;video.onLoaded=onVideoLoaded;video.onComplete=function(){if(params["showImageOnComplete"]==true){onVideoError()}if(params["onComplete"])params["onComplete"]();if(params["complete"])params["complete"]()};video.init();var onAnimTimerComplete=function(evt){root.removeEventListener("onAnimationTimerComplete",onAnimTimerComplete);if(video){video.pause();video.onComplete()}};root.addEventListener("onAnimationTimerComplete",onAnimTimerComplete)}function FlyoverImage(root){var stub=logic.tree.getAssetByName("flyover");if(stub){stub=stub[0]}else{stub=new logic.createJS.Container;stub.name="flyover";root.addChild(stub)}stub.alpha=0;logic.touch.nav(stub);var fadeTime=250,displayPause=2500;var onImageLoaded=function(u){var onTimer=function(){stub.alpha=0;logic.createJS.Tween.get(stub).to({alpha:1},fadeTime).wait(displayPause).to({alpha:0},fadeTime).call(function(){if(timer)timer.reset()})};var count=initvars[C.FLYOVER_COUNT]?parseInt(initvars[C.FLYOVER_COUNT]):3;var delay=(3e4-fadeTime*2*count-displayPause*count)/Math.max(2,count);var timer=logic.utils.getTimer(onTimer,delay);var onAnimLimit=function(e){if(stub.alpha==0)stub.visible=false;timer.stop();timer=null;root.removeEventListener("onEngagement",onAnimLimit);root.removeEventListener("onAnimationComplete",onAnimLimit)};root.addEventListener("onEngagement",onAnimLimit);root.addEventListener("onAnimationComplete",onAnimLimit)};var url=initvars[C.FLYOVER_IMG]=="[failover]"?initvars[C.FAIL_TAG]:initvars[C.FLYOVER_IMG];root.loadExternalImage(url,stub,onImageLoaded)}function CountdownTimer(root){var params=root["countdownTimer"];var clock=eval(params["object"]);if(!clock)return;var endtime=initvars[C.COUNTDOWN_END]||params["end_time"];var show=initvars[C.SHOW_OVERRIDE+clock.name]?logic.utils.getBool(initvars[C.SHOW_OVERRIDE+clock.name]):true;if(!endtime||!show){clock.visible=false;return}var end=new Date(endtime);var timer=setInterval(timeBetweenDates,1e3);function timeBetweenDates(){var now=new Date;var difference=end.getTime()-now.getTime();if(difference<=0){clearInterval(timer);if(params["complete"]){params["complete"]()}else{clock.visible=false}}else{var currentTime={seconds:Math.floor(difference/1e3)};currentTime.minutes=Math.floor(currentTime.seconds/60);currentTime.hours=Math.floor(currentTime.minutes/60);currentTime.days=Math.floor(currentTime.hours/24);currentTime.weeks=Math.floor(currentTime.days/7);currentTime.hours%=24;currentTime.weeks%=52;currentTime.minutes%=60;currentTime.seconds%=60;var showTimes=function(t){var display=currentTime[t]+"";if(params["two_digits"]==true&&currentTime[t]<10){display="0"+display}if(clock.getChildByName(t)){clock[t].text=display}};["weeks","days","hours","minutes","seconds"].forEach(showTimes)}}this.updateEndTime=function(d){end=new Date(d)}}function Slideshow(root){var params=root["slideshow"];var objects=params["objects"];var images=params["images"]||[];if(!objects)return;root.addEventListener("onDisplayStart",function(){root.removeEventListener("onDisplayStart");var rec=logic.datamodel.getRecList()[0];var stub1=objects[0];var stub2=objects[1];stub1.visible=stub2.visible=true;stub1.alpha=1;stub2.alpha=0;stub1.rec=stub2.rec=rec;logic.tree.placeImage(stub1,rec,null,1);if(rec.imageCount==1)return;logic.tree.placeImage(stub2,rec,null,2);stub1.slideshowImg=1;stub2.slideshowImg=2;var onNextImage=function(){var onDone=function(){logic.tree.placeImage(stub1,rec,null,stub2.slideshowImg);stub1.slideshowImg=stub2.slideshowImg;stub1.set({alpha:1});var nextImg=stub2.slideshowImg==rec.imageCount?1:stub2.slideshowImg+1;logic.tree.placeImage(stub2,rec,null,nextImg);stub2.slideshowImg=nextImg;stub2.set({alpha:0})};logic.createJS.Tween.get(stub1).to({alpha:0,visible:true},300);logic.createJS.Tween.get(stub2).to({alpha:1,visible:true},300).call(function(){setTimeout(onDone,10)})};var delay=initvars[C.SLIDESHOW_TIME]?parseInt(initvars[C.SLIDESHOW_TIME])*1e3:params.delay?params.delay*1e3:2e3;var timer=setInterval(onNextImage,delay);root.addEventListener("onAnimationTimerComplete",function(){root.removeEventListener("onAnimationTimerComplete");clearInterval(timer);logic.tree.placeImage(stub1,rec,null,1);stub1.alpha=1;stub2.alpha=0})})}return AdRollLiquidAds.timeline={init:function(root){root.reverse=function(mc,func){if(mc.timeline.position==0)return;var onFrame=function(evt){mc.gotoAndStop(mc.timeline.position-1);if(mc.timeline.position==0){mc.removeEventListener("tick",onFrame);if(func)func()}};mc.tickEnabled=true;mc.addEventListener("tick",onFrame)};root.getAssetByName=function(name){return logic.tree.getAssetByName(name)};root.findParentIndex=function(obj){return logic.utils.getParentIndex(obj)};root.pauseAnimation=function(){logic.app.pauseAnimation();if(autoBlink)autoBlink.pause()};root.resumeAnimation=function(){logic.app.resumeAnimation();if(autoBlink)autoBlink.resume()};root.stopAnimation=function(){logic.app.stopAnimation();if(autoBlink)autoBlink.stop()};root.selectProduct=function(idx){logic.app.onProductSelect("image"+idx)};root.loadExternalImage=function(url,stub,func){logic.utils.loadImage(url,function(img){var bitmap=new logic.createJS.Bitmap(img);stub.addChild(bitmap);func(url)},function(xhr){logic.utils.log(">> ERROR: Unable to load external image at: "+url)})};root.trace=function(msg){logic.utils.log(msg)};root.autoBlinkInstance=function(){return autoBlink||null};root.dscMenuInstance=function(){return dscMenu||null}},discover:function(root){if(root["autoBlink"]!==undefined){var activate=logic.utils.getBool(initvars[C.AUTO_SCROLL]);if(initvars[C.AUTO_BLINK_CANCEL]!==undefined){activate=!logic.utils.getBool(initvars[C.AUTO_BLINK_CANCEL])}if(activate)autoBlink=new AutoBlinkComponent(root)}if(root["pageMenu"]!==undefined){pageMenu=new PageMenuComponent(root)}if(initvars[C.FLYOVER_IMG]!==undefined){flyoverImg=new FlyoverImage(root)}if(root["countdownTimer"]!==undefined){countdownTimer=new CountdownTimer(root)}if(root["slideshow"]!==undefined){slideshow=new Slideshow(root)}if(root["videoLoop"]!==undefined){videoLoop=new VideoLoopComponent(root)}if(logic.app.isMobile()==true)return;if(root["dscMenu"]!==undefined){dscMenu=new InteractiveMenu(root)}if(root["zoomComponent"]!==undefined){var params=root["zoomComponent"];if(!params["objects"])return;imageZoomList=[];for(var i=0;i<params["objects"].length;i++){imageZoomList.push(new ImageZoomComponent(eval(params["objects"][i]),params))}}},customButton:function(obj){var helper=new logic.createJS.ButtonHelper(obj,"out","over","down",true)},getInstance:function(id){switch(id){case"autoBlink":return autoBlink;case"dscMenu":return dscMenu;case"pageMenu":return pageMenu;case"videoLoop":return videoLoop;case"imageZoomList":return imageZoomList;case"flyoverImg":return flyoverImg;case"countdownTimer":return countdownTimer;case"slideshow":return slideshow}return null}}})();(function(){var logic=AdRollLiquidAds;var SLICES=12;var RADIUS=6;var mainLoader;function Preloader(cont){var shell,timer,dimensions;shell=new logic.createJS.Container;shell.name=cont.name+"_preloader";if(cont instanceof logic.createJS.Stage){dimensions={width:cont.canvas.width,height:cont.canvas.height}}else{dimensions={width:cont.__proto__.nominalBounds.width,height:cont.__proto__.nominalBounds.height}}cont.addChild(shell);var self=this;this.border=true;this.bkgrd=true;this.load=function(url){logic.utils.loadImage(url,function(img){var bitmap=new logic.createJS.Bitmap(img);shell.addChild(bitmap);var onTimer=function(){};timer=setInterval(onTimer,999999999)},function(xhr){logic.utils.log("ERROR: Couldn't load preloader image.",xhr);self.activate()})};this.activate=function(){var screen=new logic.createJS.Shape;if(self.border==true){screen.graphics.beginStroke("#DDDDDD");screen.graphics.setStrokeStyle(1)}screen.snapToPixel=true;var fill=this.bkgrd?"#FFFFFF":null;screen.graphics.beginFill(fill);screen.graphics.drawRect(0,0,dimensions.width,dimensions.height);shell.addChild(screen);var spinner=new logic.createJS.Container;shell.addChild(spinner);var getSlice=function(){var slice=new logic.createJS.Shape;slice.graphics.beginFill("666666");slice.graphics.drawRoundRect(-1,0,2,6,1);slice.graphics.endFill();return slice};var index=SLICES;var degrees=360/SLICES;while(index--){var slice=getSlice();slice.alpha=Math.max(.2,1-.1*index);var radianAngle=degrees*index*Math.PI/180;slice.rotation=-degrees*index;slice.x=Math.sin(radianAngle)*RADIUS;slice.y=Math.cos(radianAngle)*RADIUS;spinner.addChild(slice)}spinner.x=dimensions.width/2;spinner.y=dimensions.height/2;var onTimer=function(){spinner.rotation=(spinner.rotation+360/SLICES)%360;try{logic.app.getStage().update()}catch(e){logic.utils.log("ERROR: Can't update the stage from preloader due to: "+e.message)}};timer=setInterval(onTimer,65)};this.deactivate=function(){if(timer==null){return}window.clearInterval(timer);timer=null;logic.createJS.Tween.get(shell).to({alpha:0},300).call(self.clear)};this.clear=function(obj){if(timer){window.clearInterval(timer);timer=null}if(shell){shell.removeAllChildren();cont.removeChild(shell);shell=null}}}return AdRollLiquidAds.preloader={init:function(stage){mainLoader=new Preloader(stage);if(initvars[logic.CONSTANTS.PRELOAD_IMG]!==undefined){var url=initvars[logic.CONSTANTS.PRELOAD_IMG];if(url=="[failover]"){url=initvars[logic.CONSTANTS.FAIL_TAG]}else if(url=="[background]"){url=initvars[logic.CONSTANTS.BG_TAG]}mainLoader.load(url)}else{mainLoader.activate(stage)}return mainLoader},create:function(obj){return new Preloader(obj)}}})();window.onload=function(){if(initvars.type!=AdRollLiquidAds.CONSTANTS.TYPE_DYNAMIC_TESTS){return AdRollLiquidAds.app.init()}};(function(){var logic=AdRollLiquidAds;var C=logic.CONSTANTS;var INIT_TIMEOUT=4;var PAUSE_TIME=5;var ANIM_LIMIT=30;var preloader,timer,stageWidth,stageHeight,recList,recIndex,fontLoadStats,productMap,startTime,exportRoot,isMobile,video,status,templateId,features;function attachCreative(){exportRoot=new logic.flashLib.product;exportRoot.name="root";logic.timeline.init(exportRoot);var canvas=document.getElementById("liquidAdCanvas");var stage=new logic.createJS.Stage(canvas);stage.addChild(exportRoot);try{stage.update()}catch(e){logic.utils.logError("ERROR: Can't update the stage from attachCreative.",e)}exportRoot.stop();exportRoot.visible=false;stageWidth=stage.canvas.width/stage.scaleX;stageHeight=stage.canvas.height/stage.scaleY;logic.touch.init(exportRoot);preloader=logic.preloader.init(stage);exportRoot.timeline.addEventListener("change",onTimelineChange);logic.createJS.Ticker.framerate=logic.flashLib.properties.fps;logic.createJS.Ticker.addEventListener("tick",onTick);if(window.devicePixelRatio){var canvasHeight=canvas.height;var canvasWidth=canvas.width;canvas.width=Math.round(canvasWidth*window.devicePixelRatio);canvas.height=Math.round(canvasHeight*window.devicePixelRatio);canvas.style.width=canvasWidth+"px";canvas.style.height=canvasHeight+"px";stage.scaleX=stage.scaleY=window.devicePixelRatio}var context=canvas.getContext("2d");context.imageSmoothingQuality="high";context.mozImageSmoothingEnabled=true;context.webkitImageSmoothingEnabled=true;context.msImageSmoothingEnabled=true;context.imageSmoothingEnabled=true;if(exportRoot.customFont!==undefined&&exportRoot.customFont[0].name.indexOf("Meiryo")!=0){WebFontConfig.fontactive=WebFontConfig.fontinactive=onFontLoadResolved;fontLoadStats={count:0,target:0,wait:false};logic.utils.loadFonts(exportRoot,fontLoadStats)}try{logic.tree.discover(exportRoot)}catch(err){logic.tracking.sentryException(err,{tags:{action:"tree_discover"}})}try{logic.timeline.discover(exportRoot)}catch(err){logic.tracking.sentryException(err,{tags:{action:"timeline_discover"}})}}function onTick(){try{logic.app.getStage().update()}catch(e){if(logic.createJS.Ticker.getMeasuredFPS()<logic.createJS.Ticker.framerate){var fps=logic.createJS.Ticker.framerate>10?logic.createJS.Ticker.framerate-1:logic.createJS.Ticker.framerate;logic.createJS.Ticker.framerate=fps}logic.utils.logError("ERROR: Can't update the stage from tick handler. ",e)}}function onFontLoadResolved(fam,fvd){fontLoadStats.count++;logic.utils.log(">> Font resolved: "+fontLoadStats.count+" of "+fontLoadStats.target+" loaded.");if(fontLoadStats.count==fontLoadStats.target&&fontLoadStats.wait==true){start()}}function onBkgrdResolved(){if(logic.tree.getAssetByName("logo")&&initvars[C.LOGO_TAG]!==undefined){logic.utils.loadImage(initvars[C.LOGO_TAG],function(img){var stub=logic.tree.getAssetByName("logo")[0];var bitmap=logic.tree.setImage(img,stub);stub.removeAllChildren();stub.addChild(bitmap);logic.touch.stage(stub);logic.datamodel.init()},function(xhr){logic.utils.log("ERROR: Could not load the logo image.",xhr);logic.datamodel.init()});return}if(initvars.type!=C.TYPE_DYNAMIC_TWA||initvars[C.PRODUCT_DATA]!==undefined){logic.datamodel.init()}}function onVideoLoaded(evt){var container=logic.tree.getAssetByName("video")[0];container.mouseEnabled=container.mouseChildren=false;var bitmap=new logic.createJS.Bitmap(video.getHtml().element);var player=container.getChildByName("player")?container.getChildByName("player"):container;player.addChildAt(bitmap,0);video.play();preloader.deactivate()}function onVideoComplete(evt){status=C.STATUS_RUNNING;start();var stub=logic.tree.getAssetByName("video")[0];logic.createJS.Tween.get(stub).to({alpha:0},300).call(function(){stub.removeAllChildren();exportRoot.removeChild(stub);video.shutdown();video=null})}function onVideoError(evt){logic.tree.getAssetByName("video")[0].visible=false;video.shutdown();video=null;status=C.STATUS_RUNNING;start()}function fail(error,msg){if(status==C.STATUS_FAILED)return;status=C.STATUS_FAILED;if(timer){timer.stop();timer=null}var renderImage=function(img){var scale=1;if(exportRoot){preloader.clear();var stage=exportRoot.stage;scale=stage.scaleX<1?1:stage.scaleX;logic.createJS.Ticker.removeAllEventListeners();stage.enableDOMEvents(false);stage.removeAllChildren();stage.autoClear=true;stage.clear()}var canvas=document.getElementById("liquidAdCanvas");var context=canvas.getContext("2d");canvas.style.cursor="pointer";var width=img.width*scale;var height=img.height*scale;var left=0+(canvas.width-width)/2;var top=0+(canvas.height-height)/2;context.drawImage(img,left,top,width,height);context.translate(.5,.5);context.strokeStyle="#000";context.lineWidth=2*scale;context.strokeRect(0,0,canvas.width,canvas.height);canvas.addEventListener("click",function(e){logic.app.onStageSelect(null,"failover")})};var loadFailoverImage=function(){logic.utils.loadImage(initvars[C.FAIL_TAG],renderImage,function(xhr){logic.utils.log("ERROR: Could not load failover image.",xhr)})};var loadExternalFailoverImage=function(){logic.utils.loadImageWithDOM(initvars[C.EXTERNAL_FAIL_TAG],function(img){img.width==1&&img.height==1?loadFailoverImage():renderImage(img)},function(xhr){logic.utils.log("ERROR: Could not load external failover image.",xhr);loadFailoverImage()},true)};if(initvars[C.EXTERNAL_FAIL_TAG]){loadExternalFailoverImage()}else{loadFailoverImage()}var initStats=logic.datamodel.getInitLoadStats();logic.tracking.logEvent(C.EVENT_FAILURE,{code:error,init:initStats?initStats.data_init:"no_stats",imgs:initStats?initStats.img_load_suc:"no_stats",recs:initStats?initStats.valid_recs.length:"no_stats",msg:msg});var message="> FAILURE SUMMARY\n";if(!initStats){message+="• Stats never initialized."}else{message+="• code: "+error+"\n";message+="• message: "+msg+"\n";message+="• prods: "+initStats.valid_prods.join()+"\n";message+="• valid recs: "+initStats.valid_recs.join()+"\n";message+="• invalid recs: "+initStats.invalid_recs.join()+"\n";message+="• img loads: "+initStats.img_load_suc+" of "+initStats.img_load_att+"\n";initStats.fail_time=(new Date).getTime()-initStats.start_time.getTime();message+="• fail time: "+initStats.fail_time+" ms\n";message+="• pixel density: "+window.devicePixelRatio+"\n";message+="• init vars:\n";for(var prop in initvars){message+="  - "+prop+": "+initvars[prop]+"\n"}}logic.utils.log(message);logic.utils.logError(error+": "+msg,initStats)}function start(){if(fontLoadStats&&fontLoadStats.count<fontLoadStats.target){logic.utils.log(">> Check Font WAIT: "+fontLoadStats.count+" of "+fontLoadStats.target+" loaded.");fontLoadStats.wait=true;return}else{fontLoadStats=null}logic.tree.setStaticText();exportRoot.visible=true;if(status==C.STATUS_INTSL){video=logic.utils.createVideoPlacement(initvars[C.VIDEO_TAG],stageWidth,stageHeight,false);video.id="liquidAdVideo";video.onError=onVideoError;video.onLoaded=onVideoLoaded;video.onComplete=onVideoComplete;video.init();return}logic.tracking.logEvent(C.EVENT_OK,{});for(var index=1;index<=logic.tree.getNumImages();index++){var rec=recList[nextRecIndex()];var assets=logic.tree.getAssetByName("image"+index);if(!assets)assets=[];if(initvars[C.DYN_VIDEO])assets=assets.concat(logic.tree.getAssetByName("video"+index));for(var i=0;i<assets.length;i++){var container=assets[i];logic.tree.populate(index,rec);logic.touch.product(container)}mapAssetsToRec(productMap,index,rec);onProductImpression(rec)}logic.tree.setSalePriceOption();if(initvars[C.THEME_COLOR_OVERRIDE]!==undefined){var themeColor=initvars[C.THEME_COLOR_OVERRIDE];if(themeColor.indexOf(":")!=-1){themeColor=themeColor.split(",");for(index=0;index<themeColor.length;index++){var name=themeColor[index].substring(0,themeColor[index].indexOf(":")).trim();var color=themeColor[index].substring(themeColor[index].indexOf(":")+1);logic.tree.setThemeColor(color,name)}}else{logic.tree.setThemeColor(themeColor)}}var revealPause=WebFontConfig.adroll?400:10;setTimeout(preloader.deactivate,revealPause);startTime=(new Date).getTime();if(logic.utils.getBool(initvars[C.AUTO_SCROLL])==true&&logic.tree.getNumImages()>1&&recList.length>1&&initvars.type!=C.TYPE_DYNAMIC_TWA&&logic.datamodel.getMaxRecs()>=logic.datamodel.getMinRecs()){timer=logic.utils.getTimer(onAnimationTimer,PAUSE_TIME*1e3);exportRoot.dispatchEvent(new logic.createJS.Event("onPauseTimerStart"))}else{var animTimer=logic.utils.getTimer(onAnimationTimerComplete,ANIM_LIMIT*1e3);if(recList.length==1){if(logic.tree.getAssetByName("next"))logic.tree.getAssetByName("next")[0].visible=false;if(logic.tree.getAssetByName("previous"))logic.tree.getAssetByName("previous")[0].visible=false}}exportRoot.dispatchEvent(new logic.createJS.Event("onDisplayStart"))}function onTransitionComplete(){var tempMap={};var numImages=logic.tree.getNumImages();for(var index=1;index<=numImages;index++){var swapRec=index<numImages?productMap["image"+(index+1)]:recList[nextRecIndex()];logic.tree.populate(index,swapRec);mapAssetsToRec(tempMap,index,swapRec);onProductImpression(swapRec)}productMap=tempMap;exportRoot.dispatchEvent(new logic.createJS.Event("onTransitionComplete"))}function transitionToRecIndex(goto_index){var tempMap={};var numImages=logic.tree.getNumImages();recIndex=goto_index-1;for(var index=1;index<=numImages;index++){var rec=recList[nextRecIndex()];logic.tree.populate(index,rec);mapAssetsToRec(tempMap,index,rec);onProductImpression(rec)}productMap=tempMap}function onTimelineChange(evt){var timeline=evt.currentTarget;var currentFrame=timeline.position;var totalFrames=timeline.duration;if(currentFrame==totalFrames-1){onTransitionComplete();exportRoot.gotoAndStop(0);if(status!=C.STATUS_STOPPED&&logic.utils.getBool(initvars[C.AUTO_SCROLL])==true){timer=logic.utils.getTimer(onAnimationTimer,PAUSE_TIME*1e3);exportRoot.dispatchEvent(new logic.createJS.Event("onPauseTimerStart"))}}}function waitForTransitionOk(func){var checkTransitionOk=function(){var isOk=true;if(logic.datamodel.imgLoadComplete()==false){var target=Math.abs((recIndex+logic.tree.getNumImages())%recList.length);var index=recIndex>=0?recIndex:0;while(index<=target){if(recList[index].areAllImagesLoaded()==false){isOk=false;logic.utils.log(">> Check Image WAIT: "+recList[index].id);break}index++;if(index==recList.length){isOk=false;break}}}return isOk};if(checkTransitionOk()==false){var onLoadTimer=function(){if(checkTransitionOk()==true){window.clearInterval(transTimer);transTimer=null;func()}};var transTimer=setInterval(onLoadTimer,150)}else{func()}}function onAnimationTimer(){if(timer&&timer.stop){timer.stop();timer=null}if(status==C.STATUS_STOPPED)return;var now=new Date;if(now.getTime()-startTime<ANIM_LIMIT*1e3){waitForTransitionOk(function(){exportRoot.dispatchEvent(new logic.createJS.Event("onPauseTimerComplete"));transition("forward")})}else{onAnimationTimerComplete()}}function onAnimationTimerComplete(){exportRoot.dispatchEvent(new logic.createJS.Event("onAnimationTimerComplete"));var experiment=logic.datamodel.getExperiment();if(experiment&&experiment.hasOwnProperty("params")&&experiment.params.hasOwnProperty(C.ANIMATION_END_INDEX)){transitionToRecIndex(parseInt(experiment.params[C.ANIMATION_END_INDEX]))}stopAnimation()}function nextRecIndex(){recIndex=Math.abs((recIndex+1)%recList.length);return recIndex}function mapAssetsToRec(map,idx,rec){map["image"+idx]=map["button"+idx]=map["text"+idx]=rec}function next(){transition("forward")}function previous(){for(var index=logic.tree.getNumImages();index>1;index--){var rec=productMap["image"+(index-1)];logic.tree.populate(index,rec);mapAssetsToRec(productMap,index,rec)}var lastRec=productMap["image1"];var lastIndex=recList.indexOf(lastRec)-1;if(lastIndex==-1)lastIndex=recList.length-1;rec=recList[lastIndex];logic.tree.populate(1,rec);mapAssetsToRec(productMap,1,rec);transition("back")}function engagement(act){if(act=="next"||act=="previous"){act=="next"?next():previous();if(timer!=null){timer.stop();timer=null}stopAnimation()}else if(act=="badge"){logic.app.navigate(C.BADGE_CLICK_URL)}exportRoot.dispatchEvent(new logic.createJS.Event("onEngagement"));logic.tracking.logEvent(C.EVENT_ENGAGEMENT,{action:act})}function transition(dir){if(dir=="forward"){exportRoot.play()}else{exportRoot.timeline.removeEventListener("change",onTimelineChange);exportRoot.gotoAndStop(exportRoot.timeline.duration-1);exportRoot.addEventListener("tick",reverse)}exportRoot.dispatchEvent(new logic.createJS.Event("onTransitionStart"))}function reverse(evt){exportRoot.gotoAndStop(exportRoot.timeline.position-1);if(exportRoot.timeline.position==0){exportRoot.removeEventListener("tick",reverse);exportRoot.timeline.addEventListener("change",onTimelineChange);exportRoot.dispatchEvent(new logic.createJS.Event("onTransitionComplete"))}}function stopAnimation(){status=C.STATUS_STOPPED;exportRoot.dispatchEvent(new logic.createJS.Event("onAnimationComplete"));logic.utils.log(">> Animation stopped.")}function getRecTracking(rec){var track={pid:rec.id,src:rec.source,pos:recList.indexOf(rec)+1,algo_data:{}};for(var key in rec.data){if(rec.data.hasOwnProperty(key)){if(key.charAt(0)=="_"){track.algo_data[key.substr(1)]=rec.getRawData(key)}}}if(initvars[C.TRACK_DATA]!==undefined){track.field_data={};var fields=initvars[C.TRACK_DATA].split(",");for(var i=0;i<fields.length;i++){var data=rec.getRawData(fields[i]);if(data)track.field_data[fields[i]]=data}}if(rec.getAction()!="")track.action=rec.getAction();track.price_normalized=rec.getRawData("price_normalized");track.locale=rec.getRawData("locale");track.product_date=rec.getRawData("product_date");track.pghash=rec.getRawData("pghash");return track}function onProductImpression(rec){logic.tracking.logEvent(C.EVENT_IMPRESSION,getRecTracking(rec))}return AdRollLiquidAds.app={init:function(){if(window.Raven){Raven.config("https://24abae72615b4964b0128f599eabce22@app.getsentry.com/53552",{release:C.getVersion(),tags:{demo:logic.utils.isDemo(),debug:logic.utils.isDebug(),eid:logic.utils.getEID()},ignoreErrors:C.SENTRY_IGNORE_ERRS}).install()}status=C.STATUS_INIT;isMobile=logic.utils.isMobile();templateId=initvars[C.TEMPLATE_ID]?initvars[C.TEMPLATE_ID].split("/")[1]:null;initvars.isTemplatedDynamicAd=templateId!==null;if(initvars[C.INIT_LATENCY]!=undefined)INIT_TIMEOUT=parseInt(initvars[C.INIT_LATENCY]);if(initvars[C.TRANSITION_TIME]!=undefined)PAUSE_TIME=parseInt(initvars[C.TRANSITION_TIME]);if(initvars[C.FONT_URL]!=undefined)C.ADROLL_FONT_CSS=initvars[C.FONT_URL];if(initvars[C.FEATURE_FLAGS]!=undefined){features=initvars[C.FEATURE_FLAGS].split(",")}attachCreative();if(initvars.type==C.TYPE_DYNAMIC_TWA){logic.harness.init()}if(logic.tree.getNumImages()>0){var onInitTimer=function(){var stats=logic.datamodel.getInitLoadStats();if(stats&&stats.valid_recs.length>0){if(timer.numResets()==0){logic.utils.log(">> Resetting init timer ... ");timer.setDelay(2e3);timer.reset();return}}timer.stop();timer=null;fail(C.FAIL_LATENCY,"ERROR: Init timer ran out.")};INIT_TIMEOUT=logic.app.isYelpAd()?C.YELP_INIT_TIMEOUT:INIT_TIMEOUT;timer=logic.utils.getTimer(onInitTimer,INIT_TIMEOUT*1e3);if(initvars[C.RETINA_BG]&&logic.utils.isRetina()){initvars[C.BG_TAG]=initvars[C.RETINA_BG]}if(!initvars[C.BG_TAG])initvars[C.BG_TAG]="white";if(logic.utils.getUserAgent()=="safari5"){fail(C.FAIL_UNSUPPORTED,"ERROR: Cannot load on Safari 5.")}else if(initvars[C.BG_TAG].indexOf("/")!=-1&&!initvars.isTemplatedDynamicAd){logic.utils.loadImage(initvars[C.BG_TAG],function(img){var cont=logic.tree.getAssetByName("bkgrd");var scale=Math.min(cont.nominalBounds.width/img.width,cont.nominalBounds.height/img.height);if(scale!=1)cont.scaleX=cont.scaleY=scale;cont.image=img;onBkgrdResolved()},function(xhr){fail(C.FAIL_LOAD_CREATIVE,"ERROR: Could not load background image.")})}else{if(initvars.isTemplatedDynamicAd){initvars[C.BG_TAG]="#FFFFFF"}exportRoot.stage.canvas.style.background=initvars[C.BG_TAG];onBkgrdResolved()}}else{fail(C.FAIL_LOAD_CREATIVE,"ERROR: Could not display creative")}},startDisplay:function(){if(status==C.STATUS_FAILED){logic.utils.log(">> ERROR: Init timer ran out before all content was successfully loaded.");return}if(status!=C.STATUS_INIT){logic.utils.log(">> STATUS: Ad already running when startDisplay() called again. (status == '"+status+"')");return}if(initvars[C.PRELOAD_LATENCY]!==undefined){var latency=parseFloat(initvars[C.PRELOAD_LATENCY])*1e3;var diff=(new Date).getTime()-timer.getStartTime();if(diff<latency){var onPreloadTimer=function(){window.clearInterval(preloadTimer);preloadTimer=null;logic.app.startDisplay()};if(timer)timer.stop();var preloadTimer=setInterval(onPreloadTimer,latency-diff+10);return}}if(timer&&timer.stop){timer.stop();timer=null}recList=logic.datamodel.getRecList();productMap={};recIndex=-1;status=initvars[C.VIDEO_TAG]&&logic.tree.getAssetByName("video")&&!isMobile?C.STATUS_INTSL:C.STATUS_RUNNING;waitForTransitionOk(start)},onProductSelect:function(name){var rec=productMap[name];if(!rec){logic.app.onStageSelect(null);return}logic.utils.log(">>> PRODUCT:: "+name+": "+rec.id);logic.app.navigate(logic.utils.getDestinationUrl(rec.getProductUrl(),rec.clientId));var tracking=getRecTracking(rec);tracking.coords=logic.touch.getClickPos();tracking.click_origin="product";logic.tracking.logEvent(C.EVENT_CLICK,tracking)},navigate:function(url){if(initvars[C.NAV_CANCEL])return;if(!url)url=initvars.clickTAG;window.open(url,"_blank")},onStageSelect:function(loc,src){var url=loc||null;var id=null;var tracking={};if(initvars[C.STAGE_CLICK]!==undefined){url=initvars[C.STAGE_CLICK];if(initvars[C.STAGE_CLICK].toLowerCase()==="clicktag"){url=null}}else if(status==C.STATUS_INTSL){src="video"}else if(productMap&&url==null&&src!="logo"){var rec=productMap["image1"];if(rec){url=rec.getProductUrl();id=rec.clientId;tracking=getRecTracking(rec)}}var consoleId=rec?rec.id:id;logic.utils.log(">>> STAGE: "+consoleId);logic.app.navigate(logic.utils.getDestinationUrl(url,id));tracking.coords=logic.touch.getClickPos();tracking.click_origin=src?src:"stage";logic.tracking.logEvent(C.EVENT_CLICK,tracking)},onNavClick:function(act){switch(act){case"action":logic.app.onStageSelect(initvars[C.CTA_URL],"action");break;case"next":case"previous":engagement(act);break;case"flyover":var url=initvars[C.FLYOVER_CLICK]||null;logic.app.onStageSelect(url,"flyover");break;default:engagement(act);if(!initvars[C.ADD_NAV])return;var navArray=initvars[C.ADD_NAV].split(",");for(var i=0;i<navArray.length;i++){var pair=navArray[i];var instance=pair.substring(0,pair.indexOf(":"));var url=pair.substring(pair.indexOf(":")+1);if(instance==act){logic.app.onStageSelect(decodeURIComponent(logic.utils.decode_html(url)),act);break}}}},onFail:function(code,message){fail(code,message)},pauseAnimation:function(){if(timer&&status==C.STATUS_RUNNING){timer.pause()}exportRoot.stop()},resumeAnimation:function(){if(timer&&status==C.STATUS_RUNNING){timer.resume()}if(exportRoot.timeline.position>0){exportRoot.play()}},stopAnimation:function(){if(status==C.STATUS_RUNNING){stopAnimation()}},onPageMenuSelect:function(delta){var numImgs=logic.tree.getNumImages();recIndex=recList.indexOf(productMap["image"+(numImgs-1)])+delta;if(recIndex>=recList.length)recIndex=recIndex-recList.length;if(recIndex<0)recIndex=recList.length-recIndex;var rec=recList[recIndex];logic.tree.populate(numImgs,rec);mapAssetsToRec(productMap,numImgs,rec);next();if(timer!=null){timer.stop();timer=null;stopAnimation()}},isRunning:function(){return status==C.STATUS_RUNNING},isStopped:function(){return status==C.STATUS_STOPPED},isMobile:function(){return isMobile},isFailed:function(){return status==C.STATUS_FAILED},getRoot:function(){return exportRoot},getStage:function(){return exportRoot.stage},getStageDimensions:function(){return{width:stageWidth,height:stageHeight}},getPauseTime:function(){return PAUSE_TIME},getTemplateId:function(){return templateId},getRecByContainer:function(cont){var key=logic.utils.getAssetIndex(cont.name)!=-1?cont.name:cont.name+logic.utils.getParentIndex(cont);return productMap[key]},getFocusedRecIndex:function(){return recList.indexOf(productMap["image1"])},isYelpAd:function(){return templateId!=null&&C.YELP_TEMPLATE_IDS.indexOf(templateId)!=-1},isFeatureEnabled:function(f){return features!=undefined&&features.indexOf(f)!=-1}}})();
//# sourceMappingURL=https://s.adroll.com/liquidads/html5/lib/armature.js.map